---
phase: 04-live-match-experience
plan: "06"
type: execute
wave: 3
depends_on: ["04-03", "04-04", "04-05"]
files_modified: [
  "components/matches/live-match-page.tsx",
  "components/matches/lock-mode-overlay.tsx",
  "app/[locale]/teams/[teamId]/matches/[matchId]/live/page.tsx"
]
autonomous: false

must_haves:
  truths:
    - "Live match page accessible from match detail"
    - "Lock mode prevents accidental navigation and inputs"
    - "Large touch targets (min 64x64dp) for all actions"
    - "Timer controls visible and accessible during match"
    - "Scoreboard always visible showing current state"
    - "Works with wet fingers and in bright sunlight"
  artifacts:
    - path: "app/[locale]/teams/[teamId]/matches/[matchId]/live/page.tsx"
      provides: "Live match page route"
      contains: ["LiveMatchPage"]
    - path: "components/matches/live-match-page.tsx"
      provides: "Main live match component"
      min_size: "150 lines"
    - path: "components/matches/lock-mode-overlay.tsx"
      provides: "Lock mode UI with long-press unlock"
      contains: ["touch-action: none", "onTouchStart", "onTouchEnd"]
  key_links:
    - from: "Live match page"
      to: "useMatchTimer hook"
      via: "timer state"
      pattern: "const timer = useMatchTimer(matchId)"
    - from: "Live match page"
      to: "useRealtimeMatch hook"
      via: "real-time updates"
      pattern: "const { events, score } = useRealtimeMatch(matchId)"
    - from: "Lock mode"
      to: "touch-action: none"
      via: "CSS style"
      pattern: "style={{ touchAction: 'none' }}"
---

<objective>
Create mobile-optimized live match page with lock mode, large touch targets, and one-handed operation.

Purpose: Deliver pitch-optimized UX that works in any conditions and prevents accidental actions during matches.
Output: Live match page component, lock mode overlay, page route with all integrations.
</objective>

<execution_context>
@C:/Users/mikei/.config/opencode/get-shit-done/workflows/execute-plan.md
@C:/Users/mikei/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/04-live-match-experience/04-RESEARCH.md (Pattern 4: Mobile UX, Pitfall #4, #5)
@components/matches/scoreboard.tsx (From 04-03)
@components/matches/event-recorder.tsx (From 04-04)
@hooks/use-match-timer.ts (From 04-02)
@app/[locale]/teams/[teamId]/matches/[matchId]/page.tsx (Existing match detail page)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create lock mode overlay component</name>
  <files>components/matches/lock-mode-overlay.tsx</files>
  <action>
    Create components/matches/lock-mode-overlay.tsx for preventing accidental inputs:

    1. Component signature:
       ```typescript
       interface LockModeOverlayProps {
         isLocked: boolean;
         onUnlock: () => void;
         children: React.ReactNode;
       }

       export function LockModeOverlay({
         isLocked,
         onUnlock,
         children
       }: LockModeOverlayProps)
       ```

    2. Implementation:
       - When isLocked is true: render full-screen overlay over children
       - When isLocked is false: render children directly

    3. Lock mode styles (from RESEARCH.md Pattern 4):
       ```typescript
       const lockStyles: CSSProperties = {
         touchAction: 'none',        // Disable all browser touch gestures
         userSelect: 'none',         // Prevent text selection
         WebkitUserSelect: 'none',
         WebkitTouchCallout: 'none', // Prevent iOS callout menu
         pointerEvents: isLocked ? 'auto' : 'none'
       };
       ```

    4. Unlock mechanism:
       - Require long-press (2 seconds) on unlock button
       - Visual progress indicator during press (circular fill or scale)
       - Haptic feedback on successful unlock (if supported)
       - Cancel if user releases before 2 seconds

    5. Unlock button design:
       - Position: Bottom center, fixed position
       - Size: 80x80px minimum
       - Visual: Lock icon with "Hold to unlock" text
       - Progress: Animated ring or fill showing press duration
       - Styling: Semi-transparent overlay, high contrast

    6. Touch handling:
       ```typescript
       const handleTouchStart = () => {
         setIsPressing(true);
         pressTimerRef.current = setTimeout(() => {
           onUnlock();
           setIsPressing(false);
           if (navigator.vibrate) navigator.vibrate(50);
         }, 2000);
       };

       const handleTouchEnd = () => {
         if (pressTimerRef.current) {
           clearTimeout(pressTimerRef.current);
         }
         setIsPressing(false);
       };
       ```

    7. Accessibility:
       - aria-label="Screen locked. Hold for 2 seconds to unlock"
       - role="button" on unlock area
       - aria-pressed for press state
       - Focus trap when locked (focus stays on unlock button)

    8. Visual feedback:
       - Locked state: Dark overlay (rgba(0,0,0,0.7)) over content
       - Unlock button: Large centered button with lock icon
       - Progress ring: SVG circle showing press progress
       - Success: Unlock with fade animation
  </action>
  <verify>Component has touch-action: none, long-press unlock, visual feedback</verify>
  <done>Lock mode overlay with 2-second long-press unlock</done>
</task>

<task type="auto">
  <name>Task 2: Create live match page component</name>
  <files>components/matches/live-match-page.tsx</files>
  <action>
    Create components/matches/live-match-page.tsx as the main live match UI:

    1. Component signature:
       ```typescript
       interface LiveMatchPageProps {
         matchId: string;
         teamId: string;
         players: Player[];
         isAdmin: boolean;
       }

       export function LiveMatchPage({
         matchId,
         teamId,
         players,
         isAdmin
       }: LiveMatchPageProps)
       ```

    2. State management:
       - isLocked: boolean - lock mode state
       - activeTab: 'controls' | 'events' | 'history' - bottom navigation
       - showEndMatchConfirm: boolean - confirmation dialog

    3. Hook integration:
       - useMatchTimer(matchId) - for timer controls and display
       - useRealtimeMatch(matchId) - for score and events
       - useMatchEvents(matchId) - for recording events
       - useBackgroundSync(matchId) - for offline status
       - useWakeLock(timer.isRunning) - prevent screen sleep

    4. Layout (mobile-first, portrait optimized):
       ```
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ [â† Back]    LIVE MATCH     [Lock ğŸ”’]â”‚  â† Header
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                                     â”‚
       â”‚         [SCOREBOARD]               â”‚  â† Score + Timer
       â”‚         Team A 2 - 1 Team B        â”‚
       â”‚         [Timer: 34:52]             â”‚
       â”‚         [â— Connected]              â”‚
       â”‚                                     â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                                     â”‚
       â”‚      [EVENT RECORDER OR]           â”‚  â† Main content
       â”‚      [TIMER CONTROLS]              â”‚
       â”‚                                     â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚ [Controls] [Record] [History]      â”‚  â† Tab navigation
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       ```

    5. Header section:
       - Back button (left) - exits with confirmation if match active
       - "LIVE MATCH" title (center)
       - Lock toggle (right) - enables/disables lock mode
       - High contrast, sticky position

    6. Scoreboard section:
       - Reuse Scoreboard component from 04-03
       - Always visible, large display
       - Shows connection status below

    7. Timer controls (Controls tab):
       - Large circular buttons (80x80px minimum)
       - Start button (green, play icon) - shown when not running
       - Pause button (yellow, pause icon) - shown when running
       - Resume button (blue, play icon) - shown when paused
       - Reset button (gray, smaller) - long-press to confirm
       - Visual state indicators

    8. Event recording (Record tab):
       - Reuse EventRecorder component from 04-04
       - Pass currentTimeSeconds from timer
       - Shows player list for the match

    9. Event history (History tab):
       - Scrollable list of recorded events
       - Shows time, type, player, team
       - Undo button for recent events (admin only)
       - Color-coded by event type

    10. Bottom navigation:
        - Three tabs: Controls, Record, History
        - Large touch targets (56px+ height)
        - Active tab highlighted
        - Icons + text labels

    11. Lock mode integration:
        - Wrap main content in LockModeOverlay
        - Toggle lock via header button
        - Auto-lock option (lock when timer starts)

    12. Mobile optimizations:
        - touch-action: none on entire page container
        - Prevent pull-to-refresh
        - High contrast for sunlight visibility
        - Large fonts (minimum 16px, headings 24px+)
        - Safe area insets for notched devices

    13. End match flow:
        - "End Match" button (admin only)
        - Confirmation dialog
        - Updates match status to 'completed'
        - Redirects to match summary

    14. Error handling:
        - Offline indicator in header
        - Sync status badge
        - Error toasts for failed operations
  </action>
  <verify>Component integrates all hooks, has 3 tabs, lock mode, timer controls</verify>
  <done>Live match page with integrated scoreboard, timer, and event recording</done>
</task>

<task type="auto">
  <name>Task 3: Create live match page route</name>
  <files>app/[locale]/teams/[teamId]/matches/[matchId]/live/page.tsx</files>
  <action>
    Create the Next.js page for live match:

    1. File path: app/[locale]/teams/[teamId]/matches/[matchId]/live/page.tsx

    2. Server component structure:
       ```typescript
       interface LiveMatchPageProps {
         params: Promise<{ locale: string; teamId: string; matchId: string }>;
       }

       export default async function LiveMatchPage({ params }: LiveMatchPageProps)
       ```

    3. Authentication check:
       - Get user from supabase server client
       - Redirect to login if not authenticated
       - Set 'redirectTo' parameter for return after login

    4. Authorization check:
       - Fetch match and verify user is team member
       - Return 404 or unauthorized if not
       - Check admin status for timer controls

    5. Data fetching:
       - Fetch match details (teams, scheduled time, mode)
       - Fetch players who RSVP'd 'in' for this match
       - Fetch initial timer state if exists
       - Pass to client component

    6. Metadata:
       - Dynamic title: "Live Match - {Team Name}"
       - Description: "Track live match events and scores"

    7. Client component wrapper:
       - Import LiveMatchPage from components/matches/live-match-page
       - Pass all fetched data as props
       - Wrap in Suspense with loading fallback

    8. Loading state:
       - Skeleton UI while data loads
       - Match header placeholder
       - Scoreboard placeholder
       - Activity indicator

    9. Error handling:
       - notFound() if match doesn't exist
       - Unauthorized page if not team member
       - Error boundary for client errors

    10. Navigation:
        - Link back to match detail page
        - Preserve locale in URL
        - Use Link component from navigation.ts

    11. Add route to match detail:
        - Update match detail page to include "Go Live" button
        - Button only visible for scheduled or in_progress matches
        - Button navigates to /live subpage
  </action>
  <verify>Page exists at correct path, fetches data server-side, renders LiveMatchPage</verify>
  <done>Live match page route with server-side data fetching</done>
</task>

</tasks>

<verification>
- Live match page accessible from match detail
- Lock mode prevents accidental navigation
- Timer controls work with large touch targets
- Scoreboard updates in real-time
- Event recording works with current match time
- Page works offline with sync indicators
- All interactive elements have minimum 64px touch targets
- High contrast visible in bright sunlight
</verification>

<success_criteria>
1. components/matches/lock-mode-overlay.tsx exists with long-press unlock
2. components/matches/live-match-page.tsx exists with tabs and integrations
3. app/[locale]/teams/[teamId]/matches/[matchId]/live/page.tsx exists
4. Lock mode has touch-action: none and prevents navigation
5. All buttons minimum 64x64dp touch targets
6. Page integrates timer, scoreboard, event recorder, and background sync
</success_criteria>

<output>
After completion, create `.planning/phases/04-live-match-experience/04-06-SUMMARY.md`
</output>
