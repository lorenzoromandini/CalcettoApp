---
phase: 05-post-match-statistics
plan: 03
type: execute
wave: 3
depends_on: ["05-01", "05-02"]
files_modified:
  - components/navigation/team-nav.tsx
  - components/players/player-card.tsx
  - components/matches/match-history-card.tsx
  - app/[locale]/teams/[teamId]/history/match-history-page-client.tsx
  - lib/db/statistics.ts
  - messages/it.json
  - messages/en.json
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Statistics accessible from team navigation"
    - "Player cards in Roster link to player profile"
    - "Match history displays match scorers"
    - "All Italian translations are complete"
  artifacts:
    - path: "components/navigation/team-nav.tsx"
      provides: "Stats navigation link"
      contains: "Statistiche"
    - path: "components/players/player-card.tsx"
      provides: "Clickable player card linking to profile"
      contains: "href.*players"
    - path: "components/matches/match-history-card.tsx"
      provides: "Match card with scorers"
      contains: "scorers"
  key_links:
    - from: "team-nav.tsx"
      to: "teams/[teamId]/stats"
      via: "navigation link"
      pattern: "/stats"
    - from: "player-card.tsx"
      to: "players/[playerId]"
      via: "link"
      pattern: "players/"
---

<objective>
Integrate statistics into team navigation and make player cards link to profile. Add scorers display to match history cards.

Purpose: Make statistics accessible throughout the app and connect roster to player profiles.
Output: Stats navigation link, clickable player cards, match history with scorers.
</objective>

<execution_context>
@C:/Users/mikei/.config/opencode/get-shit-done/workflows/execute-plan.md
@C:/Users/mikei/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Dependencies from Plans 01-02
@lib/db/statistics.ts
@hooks/use-statistics.ts

# Existing files to modify
@components/navigation/team-nav.tsx
@components/players/player-card.tsx
@components/matches/match-history-card.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Statistics tab to team navigation</name>
  <files>components/navigation/team-nav.tsx, messages/it.json, messages/en.json</files>
  <action>
    Add a "Statistiche" (Statistics) tab to the team navigation component:
    
    **Update components/navigation/team-nav.tsx:**
    - Add a new navigation item for Statistics
    - Place it after "Cronologia" (History)
    - Link to `/teams/[teamId]/stats`
    - Use BarChart3 or Trophy icon from lucide-react
    
    **Navigation order:**
    1. Panoramica (Overview)
    2. Partite (Matches)
    3. Cronologia (History)
    4. **Statistiche (Statistics)** ‚Üê NEW
    5. Rosa (Roster)
    6. Impostazioni (Settings) - admin only
    
    **Add translations:**
    ```json
    // it.json
    "statistics": "Statistiche"
    // en.json
    "statistics": "Statistics"
    ```
  </action>
  <verify>
    npx tsc --noEmit succeeds
    grep "stats" components/navigation/team-nav.tsx shows stats link
    grep "BarChart3\|Trophy" components/navigation/team-nav.tsx shows icon import
  </verify>
  <done>
    Statistics tab added to team navigation
    Italian and English translations added
  </done>
</task>

<task type="auto">
  <name>Task 2: Make player cards link to player profile</name>
  <files>components/players/player-card.tsx</files>
  <action>
    Update player card component to link to player profile page:
    
    **Update components/players/player-card.tsx:**
    - Wrap the card content in a Next.js Link
    - Link to `/teams/[teamId]/players/[playerId]`
    - Add hover effect to indicate clickability
    - Keep existing card styling and functionality
    
    **Example:**
    ```tsx
    import Link from 'next/link'
    
    export function PlayerCard({ player, teamId, ...props }: PlayerCardProps) {
      return (
        <Link href={`/teams/${teamId}/players/${player.id}`}>
          <Card className="hover:bg-accent transition-colors cursor-pointer">
            {/* existing card content */}
          </Card>
        </Link>
      )
    }
    ```
    
    This makes all player cards in the Roster page clickable and navigate to the player's profile with statistics.
  </action>
  <verify>
    npx tsc --noEmit succeeds
    grep "Link\|href.*players" components/players/player-card.tsx shows link implementation
  </verify>
  <done>
    Player cards are clickable and link to player profile
    Hover effect indicates interactivity
  </done>
</task>

<task type="auto">
  <name>Task 3: Add scorers to match history cards</name>
  <files>components/matches/match-history-card.tsx, app/[locale]/teams/[teamId]/history/match-history-page-client.tsx, lib/db/statistics.ts</files>
  <action>
    Enhance match history cards to show goal scorers:
    
    **1. Add getMatchScorers to lib/db/statistics.ts:**
    ```typescript
    export async function getMatchScorers(matchId: string): Promise<{ player_name: string; count: number }[]>
    ```
    - Query Goal table for the match
    - Group by scorer, count goals (exclude own goals)
    - Return array of { player_name, count }
    
    **2. Update components/matches/match-history-card.tsx:**
    - Add scorers to props:
      ```typescript
      interface MatchHistoryCardProps {
        match: Match
        result: 'win' | 'loss' | 'draw'
        scorers?: { player_name: string; count: number }[]
      }
      ```
    - Display scorers after score:
      - Format: "Rossi (2), Verdi (1)"
      - Show count in parentheses if > 1
      - Limit to 3 names, add "+N" if more
    
    **3. Update app/[locale]/teams/[teamId]/history/match-history-page-client.tsx:**
    - For each completed match, fetch scorers via getMatchScorers
    - Pass scorers to MatchHistoryCard
  </action>
  <verify>
    npx tsc --noEmit succeeds
    grep "scorers" components/matches/match-history-card.tsx shows scorers display
    grep "getMatchScorers" lib/db/statistics.ts shows new function
  </verify>
  <done>
    Match history cards show top scorers
    getMatchScorers function added
  </done>
</task>

<task type="auto">
  <name>Task 4: Final translations and verification</name>
  <files>messages/it.json, messages/en.json</files>
  <action>
    Ensure all statistics translations are complete:
    
    **messages/it.json - complete statistics section:**
    ```json
    "statistics": {
      "title": "Statistiche",
      "top_scorers": "Top Marcatori",
      "top_assists": "Top Assist",
      "top_appearances": "Top Presenze",
      "top_wins": "Top Vittorie",
      "top_losses": "Top Sconfitte",
      "top_rated": "Top MVP",
      "goals": "Gol",
      "assists": "Assist",
      "appearances": "Presenze",
      "wins": "Vittorie",
      "losses": "Sconfitte",
      "draws": "Pareggi",
      "avg_rating": "Media Voto",
      "no_data": "Nessun dato disponibile",
      "player_profile": "Profilo Giocatore",
      "back_to_roster": "Torna alla Rosa"
    }
    ```
    
    **messages/en.json - complete statistics section**
    
    Verify all components use useTranslations hook correctly.
  </action>
  <verify>
    npx tsc --noEmit succeeds
    grep "statistics" messages/it.json shows complete translations
  </verify>
  <done>
    All Italian and English translations complete
  </done>
</task>

</tasks>

<verification>
1. Run `npx tsc --noEmit` to verify TypeScript compilation
2. Verify Statistics tab appears in team navigation
3. Verify player cards link to profile page
4. Verify match history cards show scorers
5. Verify all pages accessible and functional
6. Verify Italian translations are correct
</verification>

<success_criteria>
- Statistics tab added to team navigation
- Player cards in Roster link to player profile
- Match history cards show top scorers
- All statistics features accessible
- Italian and English translations complete
</success_criteria>

<output>
After completion, create `.planning/phases/05-post-match-statistics/05-03-SUMMARY.md`
</output>
