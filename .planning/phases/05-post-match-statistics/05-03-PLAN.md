---
phase: 05-post-match-statistics
plan: 03
type: execute
wave: 3
depends_on: ["05-01", "05-02"]
files_modified:
  - components/navigation/team-nav.tsx
  - components/matches/match-history-card.tsx
  - app/[locale]/teams/[teamId]/history/match-history-page-client.tsx
  - lib/db/statistics.ts
  - messages/it.json
  - messages/en.json
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Statistics accessible from team navigation"
    - "Match history displays match-level statistics (scorers)"
    - "All Italian translations are complete"
  artifacts:
    - path: "components/navigation/team-nav.tsx"
      provides: "Stats navigation link"
      contains: "Statistiche"
    - path: "components/matches/match-history-card.tsx"
      provides: "Match card with scorers"
      contains: "scorers"
  key_links:
    - from: "team-nav.tsx"
      to: "teams/[teamId]/stats"
      via: "navigation link"
      pattern: "/stats"
    - from: "match-history-card.tsx"
      to: "lib/db/statistics.ts"
      via: "getMatchScorers"
      pattern: "scorers"
---

<objective>
Integrate statistics into team navigation and match history. Add scorers display to match history cards.

Purpose: Make statistics visible and accessible throughout the app.
Output: Stats navigation link, match history with scorers, final translations.
</objective>

<execution_context>
@C:/Users/mikei/.config/opencode/get-shit-done/workflows/execute-plan.md
@C:/Users/mikei/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Dependencies from Plans 01-02
@lib/db/statistics.ts
@hooks/use-statistics.ts
@components/statistics/player-leaderboard.tsx

# Existing files to modify
@components/navigation/team-nav.tsx
@components/matches/match-history-card.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Statistics tab to team navigation</name>
  <files>components/navigation/team-nav.tsx, messages/it.json, messages/en.json</files>
  <action>
    Add a "Statistiche" (Statistics) tab to the team navigation component:
    
    **Update components/navigation/team-nav.tsx:**
    - Add a new navigation item for Statistics
    - Place it after "Cronologia" (History)
    - Link to `/teams/[teamId]/stats`
    - Use BarChart3 icon from lucide-react
    
    **Navigation order:**
    1. Panoramica (Overview) - House icon
    2. Partite (Matches) - Calendar icon
    3. Cronologia (History) - Clock icon
    4. **Statistiche (Statistics) - BarChart3 icon**  ‚Üê NEW
    5. Rosa (Roster) - Users icon
    6. Impostazioni (Settings) - Settings icon (admin only)
    
    **Add translations:**
    ```json
    // it.json - navigation section
    "statistics": "Statistiche"
    
    // en.json
    "statistics": "Statistics"
    ```
  </action>
  <verify>
    npx tsc --noEmit succeeds
    grep "stats" components/navigation/team-nav.tsx shows stats link
    grep "BarChart3" components/navigation/team-nav.tsx shows icon import
  </verify>
  <done>
    Statistics tab added to team navigation
    Italian and English translations added
  </done>
</task>

<task type="auto">
  <name>Task 2: Add scorers to match history cards</name>
  <files>components/matches/match-history-card.tsx, app/[locale]/teams/[teamId]/history/match-history-page-client.tsx, lib/db/statistics.ts</files>
  <action>
    Enhance match history cards to show goal scorers:
    
    **1. Update lib/db/statistics.ts:**
    Add `getMatchScorers(matchId: string)` function:
    ```typescript
    // Returns array of { player_id, player_name, count } for scorers in a match
    export async function getMatchScorers(matchId: string): Promise<{ player_id: string; player_name: string; count: number }[]>
    ```
    
    **2. Update components/matches/match-history-card.tsx:**
    - Add scorers to props:
      ```typescript
      interface MatchHistoryCardProps {
        match: Match
        result: 'win' | 'loss' | 'draw'
        scorers?: { player_name: string; count: number }[]  // NEW
      }
      ```
    - Display scorers after score:
      - "Rossi 23', 67' | Verdi 45'" (compact format)
      - Limit to 2 players, add "+N altri" if more
    
    **3. Update app/[locale]/teams/[teamId]/history/match-history-page-client.tsx:**
    - For each completed match, fetch top 3 scorers
    - Pass scorers data to MatchHistoryCard
  </action>
  <verify>
    npx tsc --noEmit succeeds
    grep "scorers" components/matches/match-history-card.tsx shows scorers display
    grep "getMatchScorers" lib/db/statistics.ts shows new function
  </verify>
  <done>
    Match history cards show top scorers
    getMatchScorers function added to statistics.ts
  </done>
</task>

<task type="auto">
  <name>Task 3: Final translations</name>
  <files>messages/it.json, messages/en.json</files>
  <action>
    Ensure all statistics translations are complete:
    
    **messages/it.json:**
    ```json
    "statistics": {
      "title": "Statistiche",
      "top_scorers": "Marcatori",
      "top_assisters": "Assist",
      "top_rated": "Miglior Media",
      "goals": "Gol",
      "assists": "Assist",
      "appearances": "Presenze",
      "avg_rating": "Media Voto",
      "no_data": "Nessun dato disponibile",
      "others": "altri"
    }
    ```
    
    **messages/en.json:**
    ```json
    "statistics": {
      "title": "Statistics",
      "top_scorers": "Top Scorers",
      "top_assisters": "Top Assists",
      "top_rated": "Best Average",
      "goals": "Goals",
      "assists": "Assists",
      "appearances": "Appearances",
      "avg_rating": "Average Rating",
      "no_data": "No data available",
      "others": "others"
    }
    ```
  </action>
  <verify>
    npx tsc --noEmit succeeds
    grep "statistics" messages/it.json shows complete translations
    grep "statistics" messages/en.json shows complete translations
  </verify>
  <done>
    All Italian and English translations complete
  </done>
</task>

</tasks>

<verification>
1. Run `npx tsc --noEmit` to verify TypeScript compilation
2. Verify Statistics tab appears in team navigation
3. Verify match history cards show scorers
4. Verify statistics page is accessible from navigation
5. Verify all Italian translations are correct
</verification>

<success_criteria>
- Statistics tab added to team navigation
- Match history cards show top scorers
- All statistics features accessible and functional
- Italian and English translations complete
</success_criteria>

<output>
After completion, create `.planning/phases/05-post-match-statistics/05-03-SUMMARY.md`
</output>
