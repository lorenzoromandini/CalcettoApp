---
phase: 05-post-match-statistics
plan: 03
type: execute
wave: 3
depends_on: ["05-01", "05-02"]
files_modified:
  - components/navigation/team-nav.tsx
  - components/dashboard/team-stats-section.tsx
  - app/[locale]/teams/[teamId]/page.tsx
  - app/[locale]/teams/[teamId]/history/match-history-page-client.tsx
  - lib/db/statistics.ts
  - messages/it.json
  - messages/en.json
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Statistics accessible from team navigation"
    - "Team overview shows quick stats summary"
    - "Match history displays match-level statistics"
    - "Dashboard shows statistics highlights"
  artifacts:
    - path: "components/navigation/team-nav.tsx"
      provides: "Stats navigation link"
      contains: "Statistiche"
    - path: "components/dashboard/team-stats-section.tsx"
      provides: "Dashboard statistics widget"
      contains: "TeamRecordBadge"
  key_links:
    - from: "team-nav.tsx"
      to: "teams/[teamId]/stats"
      via: "navigation link"
      pattern: "/stats"
    - from: "team-stats-section.tsx"
      to: "useTeamStatsSummary"
      via: "hook import"
      pattern: "useTeamStatsSummary"
---

<objective>
Integrate statistics into team navigation, dashboard, and match history. Add player statistics to match history display.

Purpose: Make statistics visible and accessible throughout the app, connecting all Phase 5 features.
Output: Stats navigation link, dashboard stats section, match history statistics, updated team overview.
</objective>

<execution_context>
@C:/Users/mikei/.config/opencode/get-shit-done/workflows/execute-plan.md
@C:/Users/mikei/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Dependencies from Plans 01-02
@lib/db/statistics.ts
@hooks/use-statistics.ts
@components/statistics/team-record-badge.tsx
@components/statistics/player-leaderboard.tsx

# Existing files to modify
@components/navigation/team-nav.tsx
@components/matches/match-history-card.tsx
@components/matches/completed-match-detail.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Statistics tab to team navigation</name>
  <files>components/navigation/team-nav.tsx, messages/it.json, messages/en.json</files>
  <action>
    Add a "Statistiche" (Statistics) tab to the team navigation component:
    
    **Update components/navigation/team-nav.tsx:**
    - Add a new navigation item for Statistics
    - Place it after "Cronologia" (History) and before "Rosa" (Roster)
    - Link to `/teams/[teamId]/stats`
    - Use BarChart3 or TrendingUp icon from lucide-react
    
    **Current navigation order (update):**
    1. Panoramica (Overview) - House icon
    2. Partite (Matches) - Calendar icon
    3. Cronologia (History) - Clock icon
    4. **Statistiche (Statistics) - BarChart3 icon**  ‚Üê NEW
    5. Rosa (Roster) - Users icon
    6. Impostazioni (Settings) - Settings icon (admin only)
    
    **Add translations:**
    ```json
    // it.json - navigation section
    "statistics": "Statistiche"
    
    // en.json
    "statistics": "Statistics"
    ```
  </action>
  <verify>
    npx tsc --noEmit succeeds
    grep "stats" components/navigation/team-nav.tsx shows stats link
    grep "BarChart3" components/navigation/team-nav.tsx shows icon import
  </verify>
  <done>
    Statistics tab added to team navigation
    Navigation order: Overview, Matches, History, Statistics, Roster, Settings
    Italian and English translations added
  </done>
</task>

<task type="auto">
  <name>Task 2: Add statistics summary to team overview</name>
  <files>app/[locale]/teams/[teamId]/page.tsx, components/dashboard/team-stats-section.tsx</files>
  <action>
    Add a statistics summary section to the team overview/dashboard:
    
    **Create components/dashboard/team-stats-section.tsx:**
    - Quick stats widget showing team record and key metrics
    - Compact design for dashboard embedding
    
    **Props:**
    ```typescript
    interface TeamStatsSectionProps {
      teamId: string
      className?: string
    }
    ```
    
    **Content:**
    - TeamRecordBadge at the top
    - Quick stats in a 2x2 grid:
      - Goals Scored (total)
      - Goals Conceded (total)
      - Avg Goals/Match
      - Total Matches
    - Link to full stats page
    
    **Update app/[locale]/teams/[teamId]/page.tsx:**
    - Import and add TeamStatsSection to the team overview
    - Place it after upcoming matches section
    - Only show if team has completed matches (check summary.record.total_matches > 0)
  </action>
  <verify>
    npx tsc --noEmit succeeds
    ls components/dashboard/team-stats-section.tsx exists
    grep "TeamStatsSection" app/[locale]/teams/[teamId]/page.tsx shows integration
  </verify>
  <done>
    TeamStatsSection component created
    Shows team record and quick stats
    Integrated into team overview page
  </done>
</task>

<task type="auto">
  <name>Task 3: Add match statistics to history cards and final translations</name>
  <files>components/matches/match-history-card.tsx, app/[locale]/teams/[teamId]/history/match-history-page-client.tsx, lib/db/statistics.ts, messages/it.json, messages/en.json</files>
  <action>
    Enhance match history cards and add all translations:
    
    **1. Update components/matches/match-history-card.tsx:**
    - Add goal scorers display (show top 2-3 scorers)
    - Show result with color coding (already implemented, verify)
    
    **2. Update app/[locale]/teams/[teamId]/history/match-history-page-client.tsx:**
    - For each completed match, fetch top 3 scorers
    - Pass this data to MatchHistoryCard
    
    **3. Update lib/db/statistics.ts:**
    - Add `getMatchScorers(matchId: string)` function
    - Returns array of { name, count } for top scorers in a match
    
    **4. Add complete translations to messages/it.json:**
    ```json
    "statistics": {
      "title": "Statistiche",
      "record": "Record",
      "wins": "Vittorie",
      "losses": "Perse",
      "draws": "Pareggiate",
      "wins_short": "V",
      "losses_short": "P",
      "draws_short": "S",
      "goals_scored": "Gol Fatti",
      "goals_conceded": "Gol Subiti",
      "goals_per_match": "Media Gol/Partita",
      "avg_rating": "Media Voto",
      "total_matches": "Partite Totali",
      "top_scorers": "Marcatori",
      "top_assisters": "Assist",
      "top_rated": "Miglior Media",
      "top_goalkeepers": "Portieri",
      "saves": "Paratie",
      "goals": "Gol",
      "assists": "Assist",
      "appearances": "Presenze",
      "no_data": "Nessun dato disponibile",
      "see_all": "Vedi tutto",
      "others": "altri"
    }
    ```
    
    **5. Add English translations to messages/en.json**
  </action>
  <verify>
    npx tsc --noEmit succeeds
    grep "scorers" components/matches/match-history-card.tsx shows scorers display
    grep "getMatchScorers" lib/db/statistics.ts shows new function
    grep "statistics" messages/it.json shows complete translations
  </verify>
  <done>
    Match history cards show top scorers
    getMatchScorers function added to statistics.ts
    All Italian and English translations added
  </done>
</task>

</tasks>

<verification>
1. Run `npx tsc --noEmit` to verify TypeScript compilation
2. Verify Statistics tab appears in team navigation
3. Verify TeamStatsSection shows on team overview
4. Verify match history cards show scorers
5. Verify statistics page is accessible from navigation
6. Verify all Italian translations are correct
</verification>

<success_criteria>
- Statistics tab added to team navigation (after History)
- TeamStatsSection displays record and quick stats on overview
- Match history cards show top scorers
- All statistics features accessible and functional
- Italian and English translations complete
</success_criteria>

<output>
After completion, create `.planning/phases/05-post-match-statistics/05-03-SUMMARY.md`
</output>
