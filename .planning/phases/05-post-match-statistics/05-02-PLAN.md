---
phase: 05-post-match-statistics
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - hooks/use-statistics.ts
  - components/statistics/player-stats-card.tsx
  - components/statistics/player-leaderboard.tsx
  - app/[locale]/teams/[teamId]/stats/page.tsx
  - app/[locale]/teams/[teamId]/players/[playerId]/page.tsx
  - messages/it.json
  - messages/en.json
autonomous: true
user_setup: []

must_haves:
  truths:
    - "User can view player profile with full statistics by clicking on player from Roster"
    - - "User can view team statistics page with all leaderboards"
    - "User can see top scorers, assists, appearances, wins, losses"
    - "Statistics display uses Italian labels"
  artifacts:
    - path: "hooks/use-statistics.ts"
      provides: "React hooks for statistics data"
      exports: ["usePlayerStats", "useTeamLeaderboards"]
    - path: "app/[locale]/teams/[teamId]/players/[playerId]/page.tsx"
      provides: "Player profile page with statistics"
      contains: "PlayerStatsCard"
    - path: "app/[locale]/teams/[teamId]/stats/page.tsx"
      provides: "Team statistics page with all leaderboards"
      contains: "PlayerLeaderboard"
  key_links:
    - from: "hooks/use-statistics.ts"
      to: "lib/db/statistics.ts"
      via: "server action calls"
      pattern: "getPlayerStats|getTopScorers"
    - from: "player profile page"
      to: "usePlayerStats"
      via: "hook import"
      pattern: "usePlayerStats"
---

<objective>
Create React hooks, player profile page, and team statistics page with all leaderboards.

Purpose: Provide visual presentation layer for statistics data, enabling users to view individual player profiles and team leaderboards.
Output: Statistics hooks, player profile page, team stats page with all leaderboards.
</objective>

<execution_context>
@C:/Users/mikei/.config/opencode/get-shit-done/workflows/execute-plan.md
@C:/Users/mikei/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Dependencies from Plan 01
@lib/db/statistics.ts

# Existing patterns
@hooks/use-player-ratings.ts
@app/[locale]/teams/[teamId]/players/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create statistics React hooks</name>
  <files>hooks/use-statistics.ts</files>
  <action>
    Create hooks/use-statistics.ts with React hooks wrapping the statistics server actions:
    
    **Hooks to implement:**
    
    1. `usePlayerStats(playerId: string, teamId?: string)`
       - Fetches PlayerStats on mount
       - Returns { stats, isLoading, error, refresh }
    
    2. `useTeamLeaderboards(teamId: string)`
       - Combined hook that fetches all leaderboards at once
       - Returns { scorers, assisters, appearances, wins, losses, rated, isLoading, error }
    
    **Implementation pattern (follow use-player-ratings.ts):**
    ```typescript
    export function usePlayerStats(playerId: string, teamId?: string) {
      const [stats, setStats] = useState<PlayerStats | null>(null)
      const [isLoading, setIsLoading] = useState(true)
      const [error, setError] = useState<string | null>(null)
      
      useEffect(() => {
        async function fetchStats() {
          setIsLoading(true)
          setError(null)
          try {
            const result = await getPlayerStats(playerId, teamId)
            setStats(result)
          } catch (err) {
            setError(err instanceof Error ? err.message : 'Errore nel caricamento')
          } finally {
            setIsLoading(false)
          }
        }
        fetchStats()
      }, [playerId, teamId])
      
      return { stats, isLoading, error, refresh }
    }
    ```
  </action>
  <verify>
    npx tsc --noEmit succeeds
    grep -n "usePlayerStats\|useTeamLeaderboards" hooks/use-statistics.ts shows all hooks
  </verify>
  <done>
    hooks/use-statistics.ts created with 2 exported hooks
    All hooks properly typed
    Loading and error states handled
  </done>
</task>

<task type="auto">
  <name>Task 2: Create PlayerStatsCard component</name>
  <files>components/statistics/player-stats-card.tsx</files>
  <action>
    Create components/statistics/player-stats-card.tsx for displaying full player statistics:
    
    **Props:**
    ```typescript
    interface PlayerStatsCardProps {
      stats: PlayerStats
      showTitle?: boolean
      className?: string
    }
    ```
    
    **Visual design:**
    - Player avatar and name at top
    - Statistics grid (2x3 on mobile, 3x2 on desktop):
      - Gol: {goals} (soccer ball icon)
      - Assist: {assists} (pass icon)
      - Presenze: {appearances} (users icon)
      - Vittorie: {wins} (trophy icon, green)
      - Sconfitte: {losses} (X icon, red)
      - Pareggi: {draws} (minus icon, gray)
    - Media Voto: {avg_rating?.toFixed(2)} with star icon (if available)
    
    **Implementation:**
    - Use shadcn/ui Card component
    - Use lucide-react icons
    - Mobile-first design
    - Italian labels
    
    Create the components/statistics directory if it doesn't exist.
  </action>
  <verify>
    npx tsc --noEmit succeeds
    ls components/statistics/player-stats-card.tsx exists
  </verify>
  <done>
    PlayerStatsCard component created
    Displays all player statistics: goals, assists, appearances, wins, losses, draws, avg rating
  </done>
</task>

<task type="auto">
  <name>Task 3: Create PlayerLeaderboard component</name>
  <files>components/statistics/player-leaderboard.tsx</files>
  <action>
    Create components/statistics/player-leaderboard.tsx:
    
    **Props:**
    ```typescript
    interface PlayerLeaderboardProps {
      title: string
      entries: PlayerLeaderboardEntry[]
      valueLabel: string
      isLoading?: boolean
      emptyMessage?: string
      className?: string
    }
    ```
    
    **Visual design:**
    - Card with title header
    - List of top 5 players with:
      - Position number (1, 2, 3 with medal colors)
      - Player avatar (32px)
      - Player name
      - Value on right (bold)
    - Empty state when no data
    
    **Position styling:**
    - 1st: Gold (#FFD700), trophy icon
    - 2nd: Silver (#C0C0C0), medal icon
    - 3rd: Bronze (#CD7F32), medal icon
    - 4th-5th: Default text
  </action>
  <verify>
    npx tsc --noEmit succeeds
    ls components/statistics/player-leaderboard.tsx exists
  </verify>
  <done>
    PlayerLeaderboard component created
    Shows top players with position badges
  </done>
</task>

<task type="auto">
  <name>Task 4: Create player profile page</name>
  <files>app/[locale]/teams/[teamId]/players/[playerId]/page.tsx</files>
  <action>
    Create player profile page accessible from Roster:
    
    **Page structure:**
    - Header with player name, avatar, nickname
    - Player info section (roles, jersey number)
    - PlayerStatsCard showing all statistics
    - Back button to return to roster
    
    **Server component (page.tsx):**
    - Get playerId from params
    - Get player info (name, avatar, roles)
    - Get jersey number from player_teams for this team
    - Pass to client component
    
    **Client component (player-profile-client.tsx):**
    - Use usePlayerStats hook
    - Display loading skeleton while fetching
    - Show PlayerStatsCard with full stats
    - Handle player not found
    
    **Update player card in roster:**
    - Make player cards clickable
    - Link to `/teams/[teamId]/players/[playerId]`
  </action>
  <verify>
    npx tsc --noEmit succeeds
    ls app/[locale]/teams/[teamId]/players/[playerId]/page.tsx exists
  </verify>
  <done>
    Player profile page created
    Shows player info and full statistics
    Accessible by clicking on player from Roster
  </done>
</task>

<task type="auto">
  <name>Task 5: Create team statistics page</name>
  <files>app/[locale]/teams/[teamId]/stats/page.tsx, messages/it.json, messages/en.json</files>
  <action>
    Create team statistics page with all leaderboards:
    
    **Page structure:**
    - Header: "Statistiche" + team name
    - Leaderboards grid (responsive):
      - Row 1: Top Marcatori (scorers), Top Assist, Top Presenze (appearances)
      - Row 2: Top Vittorie (wins), Top Sconfitte (losses), Top MVP (avg rating)
    
    **Client component (stats-page-client.tsx):**
    - Use useTeamLeaderboards hook
    - Show 6 PlayerLeaderboard components
    - Loading skeletons while fetching
    - Handle empty states
    
    **Add translations to messages/it.json:**
    ```json
    "statistics": {
      "title": "Statistiche",
      "top_scorers": "Top Marcatori",
      "top_assists": "Top Assist",
      "top_appearances": "Top Presenze",
      "top_wins": "Top Vittorie",
      "top_losses": "Top Sconfitte",
      "top_rated": "Top MVP",
      "goals": "Gol",
      "assists": "Assist",
      "appearances": "Presenze",
      "wins": "Vittorie",
      "losses": "Sconfitte",
      "draws": "Pareggi",
      "avg_rating": "Media Voto",
      "no_data": "Nessun dato disponibile"
    }
    ```
    
    **Add English translations to messages/en.json**
  </action>
  <verify>
    npx tsc --noEmit succeeds
    ls app/[locale]/teams/[teamId]/stats/page.tsx exists
    grep "statistics" messages/it.json shows translations
  </verify>
  <done>
    Team statistics page created with 6 leaderboards
    Italian and English translations added
  </done>
</task>

</tasks>

<verification>
1. Run `npx tsc --noEmit` to verify TypeScript compilation
2. Verify player profile page shows all stats
3. Verify team stats page shows all 6 leaderboards
4. Verify player cards in roster link to profile
5. Verify Italian translations are correct
</verification>

<success_criteria>
- usePlayerStats hook fetches player statistics
- PlayerStatsCard shows goals, assists, appearances, wins, losses, draws, avg rating
- Player profile page accessible from Roster
- Team statistics page shows 6 leaderboards (scorers, assists, appearances, wins, losses, MVP)
- Italian translations complete
</success_criteria>

<output>
After completion, create `.planning/phases/05-post-match-statistics/05-02-SUMMARY.md`
</output>
