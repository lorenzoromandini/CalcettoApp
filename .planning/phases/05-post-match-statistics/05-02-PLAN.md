---
phase: 05-post-match-statistics
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - hooks/use-statistics.ts
  - components/statistics/player-stats-card.tsx
  - components/statistics/team-record-badge.tsx
  - components/statistics/player-leaderboard.tsx
  - app/[locale]/teams/[teamId]/stats/page.tsx
  - messages/it.json
  - messages/en.json
autonomous: true
user_setup: []

must_haves:
  truths:
    - "User can view team win/loss/draw record"
    - "User can view player statistics on profile or stats page"
    - "User can see top scorers and assisters"
    - "Statistics display uses Italian labels"
  artifacts:
    - path: "hooks/use-statistics.ts"
      provides: "React hooks for statistics data"
      exports: ["usePlayerStats", "useTeamRecord", "useTopScorers"]
    - path: "components/statistics/player-stats-card.tsx"
      provides: "Player career stats display"
      contains: "goals, assists, appearances"
    - path: "components/statistics/team-record-badge.tsx"
      provides: "W/L/D display component"
      contains: "wins, losses, draws"
    - path: "app/[locale]/teams/[teamId]/stats/page.tsx"
      provides: "Team statistics page"
      contains: "TeamRecordBadge, PlayerLeaderboard"
  key_links:
    - from: "hooks/use-statistics.ts"
      to: "lib/db/statistics.ts"
      via: "server action calls"
      pattern: "getPlayerStats|getTeamRecord"
    - from: "components/statistics/*"
      to: "hooks/use-statistics.ts"
      via: "hook imports"
      pattern: "usePlayerStats|useTeamRecord"
---

<objective>
Create React hooks and UI components for displaying player statistics, team records, and leaderboards.

Purpose: Provide visual presentation layer for statistics data, enabling users to view career stats and team performance.
Output: Statistics hooks, player stats card, team record badge, leaderboard components, team stats page.
</objective>

<execution_context>
@C:/Users/mikei/.config/opencode/get-shit-done/workflows/execute-plan.md
@C:/Users/mikei/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-post-match-statistics/05-RESEARCH.md

# Dependencies from Plan 01
@lib/db/statistics.ts

# Existing patterns
@hooks/use-player-ratings.ts
@components/matches/ratings-list.tsx
@components/matches/match-history-card.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create statistics React hooks</name>
  <files>hooks/use-statistics.ts</files>
  <action>
    Create hooks/use-statistics.ts with React hooks wrapping the statistics server actions from lib/db/statistics.ts:
    
    **Hooks to implement:**
    
    1. `usePlayerStats(playerId: string, teamId?: string)`
       - Fetches PlayerStats on mount and when playerId/teamId changes
       - Returns { stats, isLoading, error, refresh }
       - Handle null case (player not found)
    
    2. `useTeamRecord(teamId: string)`
       - Fetches TeamRecord for the team
       - Returns { record, isLoading, error }
    
    3. `useTeamStatsSummary(teamId: string)`
       - Fetches TeamStatsSummary (record + goals + averages)
       - Returns { summary, isLoading, error }
    
    4. `useTopScorers(teamId: string, limit?: number)`
       - Fetches top scorers leaderboard
       - Returns { scorers, isLoading, error }
    
    5. `useTopAssisters(teamId: string, limit?: number)`
       - Fetches top assisters leaderboard
       - Returns { assisters, isLoading, error }
    
    6. `useTopRatedPlayers(teamId: string, limit?: number)`
       - Fetches top rated players leaderboard
       - Returns { players, isLoading, error }
    
    7. `useTopGoalkeepers(teamId: string, limit?: number)`
       - Fetches top goalkeepers by saves
       - Returns { goalkeepers, isLoading, error }
    
    8. `useTeamLeaderboards(teamId: string)`
       - Combined hook that fetches all leaderboards at once
       - Returns { scorers, assisters, rated, goalkeepers, isLoading, error }
    
    **Implementation pattern (follow use-player-ratings.ts):**
    ```typescript
    export function usePlayerStats(playerId: string, teamId?: string) {
      const [stats, setStats] = useState<PlayerStats | null>(null)
      const [isLoading, setIsLoading] = useState(true)
      const [error, setError] = useState<string | null>(null)
      
      useEffect(() => {
        async function fetchStats() {
          setIsLoading(true)
          setError(null)
          try {
            const result = await getPlayerStats(playerId, teamId)
            setStats(result)
          } catch (err) {
            setError(err instanceof Error ? err.message : 'Errore nel caricamento')
          } finally {
            setIsLoading(false)
          }
        }
        fetchStats()
      }, [playerId, teamId])
      
      const refresh = useCallback(async () => {
        // Re-fetch logic
      }, [playerId, teamId])
      
      return { stats, isLoading, error, refresh }
    }
    ```
  </action>
  <verify>
    npx tsc --noEmit succeeds
    grep -n "usePlayerStats\|useTeamRecord\|useTopScorers" hooks/use-statistics.ts shows all hooks
  </verify>
  <done>
    hooks/use-statistics.ts created with 8 exported hooks
    All hooks properly typed
    Loading and error states handled
  </done>
</task>

<task type="auto">
  <name>Task 2: Create TeamRecordBadge component</name>
  <files>components/statistics/team-record-badge.tsx</files>
  <action>
    Create components/statistics/team-record-badge.tsx:
    
    **Props:**
    ```typescript
    interface TeamRecordBadgeProps {
      wins: number
      losses: number
      draws: number
      showLabel?: boolean  // Show "Record:" label
      size?: 'sm' | 'md' | 'lg'
      className?: string
    }
    ```
    
    **Visual design:**
    - Display as horizontal badge: "5V-2P-1S" (V=Vittorie/Wins, P=Perse/Losses, S=Sconfitte/Draws - or use W-L-D)
    - Use color coding: wins (green), losses (red), draws (gray)
    - Size variants:
      - sm: text-xs, compact padding
      - md: text-sm, normal padding (default)
      - lg: text-base, larger padding
    - Optional "Record:" label on the left
    
    **Implementation:**
    ```tsx
    export function TeamRecordBadge({ wins, losses, draws, showLabel, size = 'md', className }: TeamRecordBadgeProps) {
      const sizeClasses = {
        sm: 'text-xs px-2 py-0.5',
        md: 'text-sm px-3 py-1',
        lg: 'text-base px-4 py-1.5',
      }
      
      return (
        <div className={cn('flex items-center gap-2', className)}>
          {showLabel && <span className="text-muted-foreground">Record:</span>}
          <div className={cn('flex items-center gap-1 rounded-full bg-muted', sizeClasses[size])}>
            <span className="font-semibold text-green-600">{wins}V</span>
            <span className="text-muted-foreground">-</span>
            <span className="font-semibold text-red-600">{losses}P</span>
            <span className="text-muted-foreground">-</span>
            <span className="font-semibold text-gray-500">{draws}S</span>
          </div>
        </div>
      )
    }
    ```
    
    Create the components/statistics directory if it doesn't exist.
  </action>
  <verify>
    npx tsc --noEmit succeeds
    ls components/statistics/team-record-badge.tsx exists
  </verify>
  <done>
    TeamRecordBadge component created
    Shows W-L-D with color coding
    Supports size variants
  </done>
</task>

<task type="auto">
  <name>Task 3: Create PlayerStatsCard component</name>
  <files>components/statistics/player-stats-card.tsx</files>
  <action>
    Create components/statistics/player-stats-card.tsx for displaying player career statistics:
    
    **Props:**
    ```typescript
    interface PlayerStatsCardProps {
      stats: PlayerStats
      compact?: boolean  // Show mini version without avatar
      showRating?: boolean  // Show average rating
      className?: string
    }
    ```
    
    **Visual design (full version):**
    - Card with player avatar and name at top
    - Grid of stat items below:
      - Goals: {goals} (with soccer ball icon)
      - Assists: {assists} (with pass icon)
      - Presenze (Appearances): {appearances}
      - Paratie (Saves): {saves} (only if > 0 or goalkeeper)
      - Media Voto (Avg Rating): {avg_rating?.toFixed(2)} (if showRating)
    
    **Implementation:**
    - Use shadcn/ui Card component
    - Use lucide-react icons: Trophy, Target, Users, Hand, Star
    - Mobile-first: 2x2 or 3x2 grid depending on compact mode
    - Italian labels with translations
    
    **Compact mode:**
    - Horizontal layout: "G: 5 | A: 3 | P: 12"
    - No card wrapper, just inline display
    - Used in player list rows
  </action>
  <verify>
    npx tsc --noEmit succeeds
    ls components/statistics/player-stats-card.tsx exists
  </verify>
  <done>
    PlayerStatsCard component created
    Displays goals, assists, appearances, saves, rating
    Supports compact mode for lists
  </done>
</task>

<task type="auto">
  <name>Task 4: Create PlayerLeaderboard component</name>
  <files>components/statistics/player-leaderboard.tsx</files>
  <action>
    Create components/statistics/player-leaderboard.tsx for displaying top players:
    
    **Props:**
    ```typescript
    interface PlayerLeaderboardProps {
      title: string  // e.g., "Marcatori" (Top Scorers)
      entries: PlayerLeaderboardEntry[]
      valueLabel: string  // e.g., "Gol" (Goals)
      isLoading?: boolean
      emptyMessage?: string
      className?: string
    }
    ```
    
    **Visual design:**
    - Card with title header
    - List of top 5 players:
      - Position number (1, 2, 3 with medal colors for top 3)
      - Player avatar (small, 32px)
      - Player name/nickname
      - Value on right side (large, bold)
    - Empty state when no data
    
    **Position styling:**
    - 1st: Gold color (#FFD700), trophy icon
    - 2nd: Silver color (#C0C0C0), medal icon
    - 3rd: Bronze color (#CD7F32), medal icon
    - 4th-5th: Default text color
    
    **Implementation:**
    ```tsx
    export function PlayerLeaderboard({ title, entries, valueLabel, isLoading, emptyMessage, className }: PlayerLeaderboardProps) {
      if (isLoading) {
        return <Card className={className}><CardContent className="p-4"><Skeleton count={5} /></CardContent></Card>
      }
      
      return (
        <Card className={className}>
          <CardHeader className="pb-2">
            <CardTitle className="text-lg">{title}</CardTitle>
          </CardHeader>
          <CardContent className="p-4 pt-0">
            {entries.length === 0 ? (
              <p className="text-muted-foreground text-sm">{emptyMessage || 'Nessun dato'}</p>
            ) : (
              <ul className="space-y-2">
                {entries.map((entry, index) => (
                  <li key={entry.player_id} className="flex items-center gap-3">
                    <PositionBadge position={index + 1} />
                    <Avatar className="h-8 w-8">...</Avatar>
                    <span className="flex-1 truncate">{entry.player_name}</span>
                    <span className="font-bold">{entry.value} {valueLabel}</span>
                  </li>
                ))}
              </ul>
            )}
          </CardContent>
        </Card>
      )
    }
    ```
  </action>
  <verify>
    npx tsc --noEmit succeeds
    ls components/statistics/player-leaderboard.tsx exists
  </verify>
  <done>
    PlayerLeaderboard component created
    Shows top players with position badges
    Handles loading and empty states
  </done>
</task>

<task type="auto">
  <name>Task 5: Create team statistics page</name>
  <files>app/[locale]/teams/[teamId]/stats/page.tsx, messages/it.json, messages/en.json</files>
  <action>
    Create team statistics page at app/[locale]/teams/[teamId]/stats/page.tsx:
    
    **Page structure:**
    1. Header with team name and "Statistiche" title
    2. Team record badge prominently displayed
    3. Stats summary cards (goals scored/conceded, goals per match, avg rating)
    4. Leaderboards grid (2 columns on desktop, 1 on mobile):
       - Top Scorers (Marcatori)
       - Top Assisters (Assist)
       - Top Rated (Miglior Media)
       - Top Goalkeepers (Portieri - by saves)
    
    **Server component (page.tsx):**
    - Get teamId from params
    - Get team info (name, etc.)
    - Pass to client component
    
    **Client component (stats-page-client.tsx):**
    - Use useTeamStatsSummary for record and averages
    - Use useTeamLeaderboards for all leaderboards
    - Handle loading states with skeletons
    - Handle error states with error messages
    
    **Add translations to messages/it.json and messages/en.json:**
    ```json
    // it.json - statistics section
    "statistics": {
      "title": "Statistiche",
      "record": "Record",
      "wins": "Vittorie",
      "losses": "Perse",
      "draws": "Pareggiate",
      "goals_scored": "Gol Fatti",
      "goals_conceded": "Gol Subiti",
      "goals_per_match": "Media Gol/Partita",
      "avg_rating": "Media Voto Squadra",
      "top_scorers": "Marcatori",
      "top_assisters": "Assist",
      "top_rated": "Miglior Media",
      "top_goalkeepers": "Portieri",
      "saves": "Paratie",
      "goals": "Gol",
      "assists": "Assist",
      "appearances": "Presenze",
      "no_data": "Nessun dato disponibile"
    }
    ```
    
    **Navigation:**
    - This page will be linked from team navigation (added in Plan 04)
  </action>
  <verify>
    npx tsc --noEmit succeeds
    ls app/[locale]/teams/[teamId]/stats/page.tsx exists
    grep -n "statistics" messages/it.json shows translations
  </verify>
  <done>
    Team statistics page created
    Shows team record, summary stats, and leaderboards
    Italian and English translations added
  </done>
</task>

</tasks>

<verification>
1. Run `npx tsc --noEmit` to verify TypeScript compilation
2. Verify all hooks in use-statistics.ts work with statistics.ts functions
3. Verify components render with mock data
4. Verify statistics page loads and displays data
5. Verify Italian translations are correct
</verification>

<success_criteria>
- usePlayerStats/useTeamRecord hooks fetch and cache statistics data
- TeamRecordBadge displays W-L-D with color coding
- PlayerStatsCard shows player career statistics
- PlayerLeaderboard displays top performers with position badges
- Team statistics page shows all leaderboards
- Italian translations added for all statistics UI
</success_criteria>

<output>
After completion, create `.planning/phases/05-post-match-statistics/05-02-SUMMARY.md`
</output>
