---
phase: 05-post-match-statistics
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - hooks/use-statistics.ts
  - components/statistics/player-stats-card.tsx
  - components/statistics/player-leaderboard.tsx
  - app/[locale]/teams/[teamId]/stats/page.tsx
  - messages/it.json
  - messages/en.json
autonomous: true
user_setup: []

must_haves:
  truths:
    - "User can view player statistics on stats page"
    - "User can see top scorers, assisters, and MVP"
    - "Statistics display uses Italian labels"
  artifacts:
    - path: "hooks/use-statistics.ts"
      provides: "React hooks for statistics data"
      exports: ["usePlayerStats", "useTopScorers", "useTopAssisters", "useTopRatedPlayers"]
    - path: "components/statistics/player-stats-card.tsx"
      provides: "Player career stats display"
      contains: "goals, assists, appearances"
    - path: "components/statistics/player-leaderboard.tsx"
      provides: "Leaderboard component"
      contains: "position, player, value"
    - path: "app/[locale]/teams/[teamId]/stats/page.tsx"
      provides: "Team statistics page"
      contains: "PlayerLeaderboard"
  key_links:
    - from: "hooks/use-statistics.ts"
      to: "lib/db/statistics.ts"
      via: "server action calls"
      pattern: "getPlayerStats|getTopScorers"
    - from: "components/statistics/*"
      to: "hooks/use-statistics.ts"
      via: "hook imports"
      pattern: "usePlayerStats|useTopScorers"
---

<objective>
Create React hooks and UI components for displaying player statistics and leaderboards.

Purpose: Provide visual presentation layer for statistics data, enabling users to view individual player stats and team leaderboards.
Output: Statistics hooks, player stats card, leaderboard components, team stats page.
</objective>

<execution_context>
@C:/Users/mikei/.config/opencode/get-shit-done/workflows/execute-plan.md
@C:/Users/mikei/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Dependencies from Plan 01
@lib/db/statistics.ts

# Existing patterns
@hooks/use-player-ratings.ts
@components/matches/ratings-list.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create statistics React hooks</name>
  <files>hooks/use-statistics.ts</files>
  <action>
    Create hooks/use-statistics.ts with React hooks wrapping the statistics server actions from lib/db/statistics.ts:
    
    **Hooks to implement:**
    
    1. `usePlayerStats(playerId: string, teamId?: string)`
       - Fetches PlayerStats on mount and when playerId/teamId changes
       - Returns { stats, isLoading, error, refresh }
       - Handle null case (player not found)
    
    2. `useTopScorers(teamId: string, limit?: number)`
       - Fetches top scorers leaderboard
       - Returns { scorers, isLoading, error }
    
    3. `useTopAssisters(teamId: string, limit?: number)`
       - Fetches top assisters leaderboard
       - Returns { assisters, isLoading, error }
    
    4. `useTopRatedPlayers(teamId: string, limit?: number)`
       - Fetches top rated players leaderboard
       - Returns { players, isLoading, error }
    
    5. `useTeamLeaderboards(teamId: string)`
       - Combined hook that fetches all leaderboards at once
       - Returns { scorers, assisters, rated, isLoading, error }
    
    **Implementation pattern (follow use-player-ratings.ts):**
    ```typescript
    export function usePlayerStats(playerId: string, teamId?: string) {
      const [stats, setStats] = useState<PlayerStats | null>(null)
      const [isLoading, setIsLoading] = useState(true)
      const [error, setError] = useState<string | null>(null)
      
      useEffect(() => {
        async function fetchStats() {
          setIsLoading(true)
          setError(null)
          try {
            const result = await getPlayerStats(playerId, teamId)
            setStats(result)
          } catch (err) {
            setError(err instanceof Error ? err.message : 'Errore nel caricamento')
          } finally {
            setIsLoading(false)
          }
        }
        fetchStats()
      }, [playerId, teamId])
      
      const refresh = useCallback(async () => {
        // Re-fetch logic
      }, [playerId, teamId])
      
      return { stats, isLoading, error, refresh }
    }
    ```
  </action>
  <verify>
    npx tsc --noEmit succeeds
    grep -n "usePlayerStats\|useTopScorers\|useTopAssisters\|useTopRatedPlayers" hooks/use-statistics.ts shows all hooks
  </verify>
  <done>
    hooks/use-statistics.ts created with 5 exported hooks
    All hooks properly typed
    Loading and error states handled
  </done>
</task>

<task type="auto">
  <name>Task 2: Create PlayerStatsCard component</name>
  <files>components/statistics/player-stats-card.tsx</files>
  <action>
    Create components/statistics/player-stats-card.tsx for displaying player career statistics:
    
    **Props:**
    ```typescript
    interface PlayerStatsCardProps {
      stats: PlayerStats
      compact?: boolean  // Show mini version without avatar
      className?: string
    }
    ```
    
    **Visual design (full version):**
    - Card with player avatar and name at top
    - Grid of stat items:
      - Gol: {goals} (with soccer ball icon)
      - Assist: {assists} (with pass icon)
      - Presenze: {appearances}
      - Media Voto: {avg_rating?.toFixed(2)} (if available)
    
    **Implementation:**
    - Use shadcn/ui Card component
    - Use lucide-react icons: Target, Crosshair, Users, Star
    - Mobile-first: 2x2 grid
    - Italian labels with translations
    
    **Compact mode:**
    - Horizontal layout: "G: 5 | A: 3 | P: 12"
    - No card wrapper, just inline display
    - Used in player list rows
    
    Create the components/statistics directory if it doesn't exist.
  </action>
  <verify>
    npx tsc --noEmit succeeds
    ls components/statistics/player-stats-card.tsx exists
  </verify>
  <done>
    PlayerStatsCard component created
    Displays goals, assists, appearances, avg rating
    Supports compact mode for lists
  </done>
</task>

<task type="auto">
  <name>Task 3: Create PlayerLeaderboard component and stats page</name>
  <files>components/statistics/player-leaderboard.tsx, app/[locale]/teams/[teamId]/stats/page.tsx, messages/it.json, messages/en.json</files>
  <action>
    Create leaderboard component and team statistics page:
    
    **1. Create components/statistics/player-leaderboard.tsx:**
    
    ```typescript
    interface PlayerLeaderboardProps {
      title: string  // e.g., "Marcatori" (Top Scorers)
      entries: PlayerLeaderboardEntry[]
      valueLabel: string  // e.g., "Gol" (Goals)
      isLoading?: boolean
      emptyMessage?: string
      className?: string
    }
    ```
    
    **Visual design:**
    - Card with title header
    - List of top 5 players:
      - Position number (1, 2, 3 with medal colors for top 3)
      - Player avatar (small, 32px)
      - Player name/nickname
      - Value on right side (large, bold)
    - Empty state when no data
    
    **Position styling:**
    - 1st: Gold color, trophy icon
    - 2nd: Silver color, medal icon
    - 3rd: Bronze color, medal icon
    - 4th-5th: Default text color
    
    **2. Create app/[locale]/teams/[teamId]/stats/page.tsx:**
    
    **Page structure:**
    - Header: "Statistiche" + team name
    - Leaderboards grid (1 column mobile, 3 columns desktop):
      - Top Scorers (Marcatori)
      - Top Assisters (Assist)
      - Top Rated (Miglior Media)
    
    **3. Add translations to messages/it.json:**
    ```json
    "statistics": {
      "title": "Statistiche",
      "top_scorers": "Marcatori",
      "top_assisters": "Assist",
      "top_rated": "Miglior Media",
      "goals": "Gol",
      "assists": "Assist",
      "appearances": "Presenze",
      "avg_rating": "Media Voto",
      "no_data": "Nessun dato disponibile"
    }
    ```
    
    **4. Add English translations to messages/en.json**
  </action>
  <verify>
    npx tsc --noEmit succeeds
    ls components/statistics/player-leaderboard.tsx exists
    ls app/[locale]/teams/[teamId]/stats/page.tsx exists
    grep "statistics" messages/it.json shows translations
  </verify>
  <done>
    PlayerLeaderboard component created
    Team statistics page shows all leaderboards
    Italian and English translations added
  </done>
</task>

</tasks>

<verification>
1. Run `npx tsc --noEmit` to verify TypeScript compilation
2. Verify all hooks in use-statistics.ts work with statistics.ts functions
3. Verify components render with mock data
4. Verify statistics page loads and displays data
5. Verify Italian translations are correct
</verification>

<success_criteria>
- usePlayerStats/useTopScorers hooks fetch statistics data
- PlayerStatsCard shows player career statistics
- PlayerLeaderboard displays top performers with position badges
- Team statistics page shows all leaderboards
- Italian translations added for all statistics UI
</success_criteria>

<output>
After completion, create `.planning/phases/05-post-match-statistics/05-02-SUMMARY.md`
</output>
