---
phase: 01-foundation-auth
plan: 04
type: execute
wave: 3
depends_on:
  - "01-01"
  - "01-03"
files_modified:
  - app/manifest.ts
  - public/icons/icon-192x192.png
  - public/icons/icon-512x512.png
  - public/icons/apple-touch-icon.png
  - app/layout.tsx (modified)
  - app/offline/page.tsx
  - next.config.ts (modified)
autonomous: true

must_haves:
  truths:
    - "PWA manifest is valid and installable"
    - "App icons exist in required sizes (192x192, 512x512)"
    - "Offline fallback page displays when network fails"
    - "Theme color and background color are set"
    - "Apple touch icon configured for iOS"
  artifacts:
    - path: "app/manifest.ts"
      provides: "PWA manifest (TypeScript)"
      exports: ["default"]
    - path: "public/icons/icon-192x192.png"
      provides: "PWA icon 192x192"
    - path: "public/icons/icon-512x512.png"
      provides: "PWA icon 512x512"
    - path: "public/icons/apple-touch-icon.png"
      provides: "iOS home screen icon"
    - path: "app/offline/page.tsx"
      provides: "Offline fallback page"
  key_links:
    - from: "app/manifest.ts"
      to: "public/icons/"
      via: "src paths"
    - from: "app/layout.tsx"
      to: "app/manifest.ts"
      via: "manifest link"
---

<objective>
Configure PWA manifest and assets for installability, including app icons, theme colors, and offline fallback page.

Purpose: For the app to be a true PWA that users can install to their home screen, it needs a valid web app manifest and proper icons. This plan also provides the offline fallback page that displays when the user has no connection and no cached data.

Output: Valid PWA manifest, app icons in required sizes, offline fallback page, and layout configured for installability.
</objective>

<execution_context>
@/home/ubuntu/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/ubuntu/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-auth/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PWA Manifest</name>
  <files>
    - app/manifest.ts
    - app/layout.tsx (modified)
  </files>
  <action>
    Create the PWA manifest using Next.js 15's built-in manifest.ts support per RESEARCH.md.

    Create app/manifest.ts:
    - Export default function returning MetadataRoute.Manifest
    - Set name: "Calcetto Manager"
    - Set short_name: "Calcetto" (for home screen)
    - Set description: "Organizza e gestisci le tue partite di calcetto"
    - Set start_url: "/"
    - Set display: "standalone"
    - Set background_color: "#ffffff" (light) and theme_color (match brand)
    - Set icons array with 192x192 and 512x512 sizes pointing to /icons/
    - Set orientation: "portrait"
    - Set categories: ["sports", "entertainment"]
    - Set lang: "it" (primary language)

    Modify app/layout.tsx:
    - Add viewport configuration for PWA
    - Add theme-color meta tag
    - Ensure proper html lang attribute for i18n
    - Import ServiceWorkerRegister component (will be added in Plan 07)

    Next.js 15 automatically serves manifest at /manifest.webmanifest.
  </action>
  <verify>
    - app/manifest.ts exists and exports MetadataRoute.Manifest
    - manifest includes name, short_name, icons, theme_color
    - Icons reference /icons/icon-192x192.png and /icons/icon-512x512.png
    - `npm run build` completes without errors
    - /manifest.webmanifest is accessible (can verify after build)
  </verify>
  <done>
    PWA manifest created at app/manifest.ts with app details, icons, and theme configuration
  </done>
</task>

<task type="auto">
  <name>Task 2: Create PWA Icons and Assets</name>
  <files>
    - public/icons/icon-192x192.png
    - public/icons/icon-512x512.png
    - public/icons/apple-touch-icon.png
    - public/icons/favicon.ico
  </files>
  <action>
    Create PWA icons in required sizes. Since this is a football/soccer app, create simple branded icons.

    Options for icons:
    1. Generate SVG and convert to PNG in various sizes
    2. Create a simple placeholder using a colored square with initial
    3. Use a football emoji or icon as base

    For this plan, create programmatically or use simple placeholder approach:
    - Create SVG with football theme (soccer ball icon or "CM" initials)
    - Use a tool or Node.js script to convert to PNG at 192x192 and 512x512
    - Create apple-touch-icon.png (180x180 with padding for iOS)
    - Create favicon.ico

    Simplest approach for MVP:
    - Use a solid color background (green #22c55e for football field)
    - White "CM" text or football icon
    - Generate using HTML Canvas or SVG -> PNG conversion

    Or use a placeholder service during development with note to replace with real branded icons.

    Important: Icons MUST be PNG format for PWA, ICO for favicon.
  </action>
  <verify>
    - public/icons/icon-192x192.png exists (192x192 pixels)
    - public/icons/icon-512x512.png exists (512x512 pixels)
    - public/icons/apple-touch-icon.png exists (180x180 recommended)
    - public/icons/favicon.ico exists
    - All icon files are valid images
    - Icons are referenced correctly in manifest.ts
  </verify>
  <done>
    PWA icons created: 192x192, 512x512, apple-touch-icon, and favicon
  </done>
</task>

<task type="auto">
  <name>Task 3: Create Offline Fallback Page</name>
  <files>
    - app/offline/page.tsx
  </files>
  <action>
    Create the offline fallback page that displays when the user has no connection and no cached content.

    Create app/offline/page.tsx:
    - 'use client' component (for refresh button)
    - Centered layout with icon (CloudOff from lucide-react)
    - Heading: "Sei offline" / "You're offline"
    - Message: "Controlla la tua connessione internet" / "Check your internet connection"
    - Refresh button that tries to reload
    - Styled with Tailwind for mobile-first (centered, padding)
    - Light/dark mode compatible

    This page is referenced by the Service Worker as the fallback when both network and cache fail for navigation requests.

    Structure:
    ```tsx
    'use client';
    
    import { CloudOff, RefreshCw } from 'lucide-react';
    import { Button } from '@/components/ui/button';
    
    export default function OfflinePage() {
      return (
        <div className="flex min-h-screen flex-col items-center justify-center p-4 text-center">
          <CloudOff className="h-16 w-16 text-muted-foreground mb-4" />
          <h1 className="text-2xl font-bold mb-2">Sei offline</h1>
          <p className="text-muted-foreground mb-6">
            Controlla la tua connessione internet e riprova
          </p>
          <Button onClick={() => window.location.reload()}>
            <RefreshCw className="mr-2 h-4 w-4" />
            Riprova
          </Button>
        </div>
      );
    }
    ```
  </action>
  <verify>
    - app/offline/page.tsx exists
    - Page shows offline icon, message, and refresh button
    - Uses Tailwind for responsive styling
    - TypeScript compiles without errors
  </verify>
  <done>
    Offline fallback page created at app/offline/page.tsx
  </done>
</task>

</tasks>

<verification>
After this plan completes:
1. /manifest.webmanifest is valid and accessible
2. Icons exist in all required sizes
3. Offline page displays when network fails
4. Layout includes proper viewport and theme-color
5. Build completes without errors
6. App is installable (meets PWA criteria)
</verification>

<success_criteria>
- app/manifest.ts with MetadataRoute.Manifest export
- Icons: 192x192, 512x512, apple-touch-icon, favicon
- Manifest includes name, short_name, description, icons, theme_color, background_color
- app/offline/page.tsx with friendly offline message and refresh button
- Layout includes viewport and theme-color configuration
- Build succeeds and manifest is generated
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-auth/01-04-SUMMARY.md` documenting:
- PWA manifest configuration
- Icon sizes and requirements
- Offline fallback behavior
- How to test PWA installability
</output>
