---
phase: 01-foundation-auth
plan: 05
type: execute
wave: 3
depends_on:
  - "01-01"
  - "01-02"
files_modified:
  - app/auth/login/page.tsx
  - app/auth/signup/page.tsx
  - app/auth/forgot-password/page.tsx
  - app/auth/reset-password/page.tsx
  - app/auth/auth-code-error/page.tsx
  - components/auth/login-form.tsx
  - components/auth/signup-form.tsx
  - components/auth/social-buttons.tsx
  - components/auth/auth-card.tsx
  - lib/validations/auth.ts
autonomous: true

must_haves:
  truths:
    - "User can log in with email and password"
    - "User can sign up with email and password"
    - "User can sign up/sign in with Google OAuth"
    - "User can reset password via email"
    - "Form validation shows clear error messages"
    - "Auth pages are mobile-optimized"
  artifacts:
    - path: "app/auth/login/page.tsx"
      provides: "Login page"
    - path: "app/auth/signup/page.tsx"
      provides: "Sign up page"
    - path: "app/auth/forgot-password/page.tsx"
      provides: "Password reset request page"
    - path: "app/auth/reset-password/page.tsx"
      provides: "Password reset confirmation page"
    - path: "components/auth/login-form.tsx"
      provides: "Login form component"
      exports: ["LoginForm"]
    - path: "components/auth/signup-form.tsx"
      provides: "Sign up form component"
      exports: ["SignupForm"]
    - path: "components/auth/social-buttons.tsx"
      provides: "Google OAuth button"
      exports: ["GoogleSignInButton"]
    - path: "lib/validations/auth.ts"
      provides: "Auth form validations"
      exports: ["loginSchema", "signupSchema"]
  key_links:
    - from: "components/auth/login-form.tsx"
      to: "lib/supabase/client.ts"
      via: "createClient import"
    - from: "components/auth/social-buttons.tsx"
      to: "lib/supabase/client.ts"
      via: "signInWithOAuth"
    - from: "app/auth/reset-password/page.tsx"
      to: "app/auth/callback/route.ts"
      via: "Supabase callback flow"
---

<objective>
Implement complete authentication UI with email/password login, signup, password reset, and Google OAuth.

Purpose: Users need secure access to the app. This plan creates all auth pages and forms, integrating with the Supabase auth infrastructure from Plan 02 to provide a complete authentication flow.

Output: Full auth flow including login, signup, password reset, and Google OAuth buttons, all mobile-optimized and validated.
</objective>

<execution_context>
@/home/ubuntu/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/ubuntu/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-auth/01-RESEARCH.md
@.planning/phases/01-foundation-auth/01-02-SUMMARY.md (reference supabase clients)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Auth Validation Schemas</name>
  <files>
    - lib/validations/auth.ts
  </files>
  <action>
    Create Zod validation schemas for auth forms.

    Install zod if not already present: `npm install zod`

    Create lib/validations/auth.ts with:
    - loginSchema: email (valid email), password (min 6 chars)
    - signupSchema: email, password (min 6), confirmPassword (must match)
    - forgotPasswordSchema: email only
    - resetPasswordSchema: password, confirmPassword

    Export TypeScript types inferred from schemas (LoginInput, SignupInput, etc.)

    Include proper error messages in Italian (primary language).
  </action>
  <verify>
    - lib/validations/auth.ts exists with Zod schemas
    - loginSchema, signupSchema, forgotPasswordSchema, resetPasswordSchema exported
    - Type inference types exported
    - Schemas validate correctly (test with sample data)
  </verify>
  <done>
    Auth validation schemas created using Zod with Italian error messages
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Auth Form Components</name>
  <files>
    - components/auth/login-form.tsx
    - components/auth/signup-form.tsx
    - components/auth/social-buttons.tsx
    - components/auth/auth-card.tsx
  </files>
  <action>
    Create reusable auth form components using shadcn/ui and React Hook Form.

    Install required packages: `npm install react-hook-form @hookform/resolvers zod`

    components/auth/auth-card.tsx:
    - Wrapper card with logo, title, children
    - Centered layout optimized for mobile
    - Links between auth pages

    components/auth/login-form.tsx:
    - Use react-hook-form with zodResolver
    - Email and password inputs with validation
    - Submit button with loading state
    - Error display
    - Calls supabase.auth.signInWithPassword
    - Redirect on success

    components/auth/signup-form.tsx:
    - Email, password, confirm password inputs
    - Calls supabase.auth.signUp
    - Shows success message (check email for confirmation)
    - Handles email confirmation flow

    components/auth/social-buttons.tsx:
    - Google sign-in button
    - Use supabase.auth.signInWithOAuth({ provider: 'google' })
    - Configure redirectTo: window.location.origin + '/auth/callback'
    - Add queryParams for access_type: 'offline', prompt: 'consent'
    - Styled button with Google icon

    All forms must:
    - Use shadcn/ui components (Input, Button, Label, Form)
    - Show loading states
    - Display validation errors inline
    - Be mobile-optimized (large touch targets, proper spacing)
    - Handle network errors gracefully
  </action>
  <verify>
    - All auth components exist in components/auth/
    - Forms use react-hook-form with Zod validation
    - Login form calls signInWithPassword
    - Signup form calls signUp
    - Social buttons use signInWithOAuth
    - Loading states and error handling implemented
    - TypeScript compiles without errors
  </verify>
  <done>
    Auth form components created: login, signup, social buttons, and card wrapper
  </done>
</task>

<task type="auto">
  <name>Task 3: Create Auth Pages</name>
  <files>
    - app/auth/login/page.tsx
    - app/auth/signup/page.tsx
    - app/auth/forgot-password/page.tsx
    - app/auth/reset-password/page.tsx
    - app/auth/auth-code-error/page.tsx
  </files>
  <action>
    Create all auth pages using the form components.

    app/auth/login/page.tsx:
    - Metadata for SEO
    - AuthCard with LoginForm and SocialButtons
    - Link to signup and forgot-password

    app/auth/signup/page.tsx:
    - AuthCard with SignupForm
    - Link to login
    - Note about email confirmation

    app/auth/forgot-password/page.tsx:
    - Simple form with email input
    - Calls supabase.auth.resetPasswordForEmail
    - Success message after submission

    app/auth/reset-password/page.tsx:
    - New password form
    - Called after user clicks email link
    - Calls supabase.auth.updateUser

    app/auth/auth-code-error/page.tsx:
    - Error display for failed OAuth/confirmation
    - Link back to login

    All pages:
    - Use 'use client' for interactivity
    - Mobile-first centered layout
    - Proper metadata titles
    - Handle loading and error states
  </action>
  <verify>
    - All auth pages exist in app/auth/*/
    - Pages import and use form components
    - Proper metadata on each page
    - Links between pages work
    - Mobile-optimized layout
    - TypeScript compiles without errors
  </verify>
  <done>
    All auth pages created: login, signup, forgot-password, reset-password, and error page
  </done>
</task>

</tasks>

<verification>
After this plan completes:
1. /auth/login shows login form with email/password and Google
2. /auth/signup shows signup form
3. /auth/forgot-password allows password reset request
4. Form validation works with clear error messages
5. Google OAuth redirects to Google and back to callback
6. Successful login redirects to home
7. All forms are mobile-optimized
8. Build completes without errors
</verification>

<success_criteria>
- lib/validations/auth.ts with Zod schemas
- components/auth/login-form.tsx with react-hook-form
- components/auth/signup-form.tsx with email confirmation flow
- components/auth/social-buttons.tsx with Google OAuth
- components/auth/auth-card.tsx wrapper component
- app/auth/login/page.tsx functional
- app/auth/signup/page.tsx functional
- app/auth/forgot-password/page.tsx functional
- app/auth/reset-password/page.tsx functional
- app/auth/auth-code-error/page.tsx functional
- All forms validate and handle errors
- Mobile-optimized styling
- Build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-auth/01-05-SUMMARY.md` documenting:
- Auth flow architecture
- Form validation approach
- OAuth integration
- Password reset flow
- Mobile optimization decisions
</output>
