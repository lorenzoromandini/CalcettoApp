---
phase: 02-team-management
plan: 04
type: execute
wave: 3
depends_on:
  - 02-01
  - 02-02
files_modified:
  - lib/db/invites.ts
  - lib/validations/invite.ts
  - components/teams/invite-generator.tsx
  - components/teams/invite-link-dialog.tsx
  - app/[locale]/teams/invite/page.tsx
  - app/[locale]/teams/[teamId]/settings/page.tsx
  - messages/it.json
  - messages/en.json
autonomous: true

must_haves:
  truths:
    - "Team admin can generate invite link with expiration (7 days default)"
    - "Invite link can be shared via WhatsApp, email, or copied to clipboard"
    - "Invited users can join team by visiting invite link"
    - "Invite validates token, checks expiration, and prevents duplicate joins"
    - "Joined user gets 'member' role automatically"
    - "Invite tracks usage count up to max_uses limit"
  artifacts:
    - path: "lib/db/invites.ts"
      provides: "Invite CRUD and join operations"
      exports: ["generateInviteLink", "joinTeamWithInvite", "getInviteByToken", "getTeamInvites"]
    - path: "components/teams/invite-generator.tsx"
      provides: "Invite generation UI"
      exports: ["InviteGenerator"]
    - path: "app/[locale]/teams/invite/page.tsx"
      provides: "Invite redemption page"
      contains: ["Token validation", "Join team flow", "Error states"]
    - path: "app/[locale]/teams/[teamId]/settings/page.tsx"
      provides: "Team settings with invite management"
      contains: ["InviteGenerator", "Existing invites list"]
  key_links:
    - from: "lib/db/invites.ts"
      to: "team_invites table"
      via: "Supabase INSERT/SELECT with token"
      pattern: "supabase\\.from\\('team_invites'\\)"
    - from: "invite link"
      to: "/teams/invite?token=xxx"
      via: "URL with token query param"
      pattern: "\\/teams\\/invite\\?token="
    - from: "app/[locale]/teams/invite/page.tsx"
      to: "joinTeamWithInvite function"
      via: "Join button on invite page"
      pattern: "joinTeamWithInvite\\(token, userId\\)"
---

<objective>
Implement invite system for team joining (TEAM-05, TEAM-06) allowing admins to generate shareable links and users to join teams via those links.

Purpose: Enables organic team growth through WhatsApp/email sharing - critical for adoption per research.
Output: Invite generation UI, invite redemption flow, and link sharing functionality.
</objective>

<execution_context>
@C:/Users/mikei/.config/opencode/get-shit-done/workflows/execute-plan.md
@C:/Users/mikei/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-team-management/02-RESEARCH.md
@lib/db/schema.ts

## Research Requirements (from 02-RESEARCH.md)
- Database-driven invite tokens with expiration (not JWT)
- Token generated as SHA256 hash for security
- 7 day expiration default
- max_uses allows multi-use links for WhatsApp groups
- Track usage with use_count
- Prevent duplicate joins (check existing membership)

## URL Pattern
- Invite link: /teams/invite?token=xxx
- Public page (anon can view valid invites)
- Requires auth to actually join
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create invite database operations</name>
  <files>lib/db/invites.ts</files>
  <action>
Create invite management and join operations:

```typescript
/**
 * Team Invite Operations
 * 
 * Database-driven invite tokens with expiration and usage tracking.
 * Per RESEARCH.md: Use SHA256 tokens, 7-day expiry, track usage.
 */

import { createClient } from '@/lib/supabase/client';
import { getDB } from './index';
import { queueOfflineAction } from './actions';
import type { TeamInvite, TeamMember } from './schema';

const supabase = createClient();

/**
 * Generate a secure invite token using SHA256
 */
function generateToken(teamId: string, createdBy: string): string {
  const data = `${teamId}:${createdBy}:${Date.now()}:${Math.random()}`;
  // Simple hash for demo - in production use crypto.subtle or server-side
  let hash = 0;
  for (let i = 0; i < data.length; i++) {
    const char = data.charCodeAt(i);
    hash = ((hash << 5) - hash) + char;
    hash = hash & hash;
  }
  return Math.abs(hash).toString(16).padStart(32, '0');
}

/**
 * Generate a new invite link
 */
export async function generateInviteLink(
  teamId: string,
  createdBy: string,
  options: { maxUses?: number; expiresInDays?: number } = {}
): Promise<{ invite: TeamInvite; link: string }> {
  const token = generateToken(teamId, createdBy);
  const expiresAt = new Date();
  expiresAt.setDate(expiresAt.getDate() + (options.expiresInDays || 7));

  const { data, error } = await supabase
    .from('team_invites')
    .insert({
      team_id: teamId,
      created_by: createdBy,
      token,
      expires_at: expiresAt.toISOString(),
      max_uses: options.maxUses || 50,
      use_count: 0,
    })
    .select()
    .single();

  if (error || !data) {
    throw new Error(error?.message || 'Failed to create invite');
  }

  const invite: TeamInvite = {
    id: data.id,
    team_id: data.team_id,
    created_by: data.created_by,
    token: data.token,
    email: data.email,
    expires_at: data.expires_at,
    used_at: data.used_at,
    used_by: data.used_by,
    max_uses: data.max_uses,
    use_count: data.use_count,
    created_at: data.created_at,
  };

  // Generate shareable URL
  const baseUrl = typeof window !== 'undefined' ? window.location.origin : '';
  const link = `${baseUrl}/teams/invite?token=${token}`;

  return { invite, link };
}

/**
 * Get invite by token (public - no auth required)
 */
export async function getInviteByToken(token: string): Promise<TeamInvite | null> {
  const { data, error } = await supabase
    .from('team_invites')
    .select('*')
    .eq('token', token)
    .single();

  if (error || !data) return null;

  // Check if expired or max uses reached
  const expiresAt = new Date(data.expires_at);
  const isExpired = expiresAt < new Date();
  const isMaxed = data.max_uses && data.use_count >= data.max_uses;

  if (isExpired || isMaxed) return null;

  return {
    id: data.id,
    team_id: data.team_id,
    created_by: data.created_by,
    token: data.token,
    email: data.email,
    expires_at: data.expires_at,
    used_at: data.used_at,
    used_by: data.used_by,
    max_uses: data.max_uses,
    use_count: data.use_count,
    created_at: data.created_at,
  };
}

/**
 * Get all invites for a team (admin only)
 */
export async function getTeamInvites(teamId: string): Promise<TeamInvite[]> {
  const { data, error } = await supabase
    .from('team_invites')
    .select('*')
    .eq('team_id', teamId)
    .order('created_at', { ascending: false });

  if (error || !data) return [];

  return data.map((item) => ({
    id: item.id,
    team_id: item.team_id,
    created_by: item.created_by,
    token: item.token,
    email: item.email,
    expires_at: item.expires_at,
    used_at: item.used_at,
    used_by: item.used_by,
    max_uses: item.max_uses,
    use_count: item.use_count,
    created_at: item.created_at,
  }));
}

/**
 * Join team with invite token
 */
export async function joinTeamWithInvite(
  token: string,
  userId: string
): Promise<{ success: boolean; teamId?: string; error?: string }> {
  // Get and validate invite
  const invite = await getInviteByToken(token);
  if (!invite) {
    return { success: false, error: 'invalid_or_expired' };
  }

  // Check if user is already a member
  const { data: existingMember } = await supabase
    .from('team_members')
    .select('id')
    .eq('team_id', invite.team_id)
    .eq('user_id', userId)
    .single();

  if (existingMember) {
    return { success: false, error: 'already_member' };
  }

  // Add user to team as member
  const { error: joinError } = await supabase.from('team_members').insert({
    team_id: invite.team_id,
    user_id: userId,
    role: 'member',
  });

  if (joinError) {
    return { success: false, error: 'join_failed' };
  }

  // Update invite usage
  await supabase
    .from('team_invites')
    .update({
      use_count: invite.use_count + 1,
      used_at: new Date().toISOString(),
      used_by: userId,
    })
    .eq('id', invite.id);

  // Also cache locally
  const db = await getDB();
  const member: TeamMember = {
    id: crypto.randomUUID(),
    team_id: invite.team_id,
    user_id: userId,
    player_id: null,
    role: 'member',
    joined_at: new Date().toISOString(),
    created_at: new Date().toISOString(),
  };
  await db.put('team_members', member);

  return { success: true, teamId: invite.team_id };
}

/**
 * Revoke/delete an invite (admin only)
 */
export async function revokeInvite(inviteId: string): Promise<void> {
  const { error } = await supabase
    .from('team_invites')
    .delete()
    .eq('id', inviteId);

  if (error) {
    throw new Error(error.message);
  }
}
```

NOTE: Token generation uses simple hash for demo - production should use crypto.subtle or server-side. 7-day default expiry, 50 max uses for WhatsApp sharing. joinTeamWithInvite handles all validation and prevents duplicates.
  </action>
  <verify>TypeScript compiles without errors</verify>
  <done>Invite operations with generation, validation, join flow, and usage tracking</done>
</task>

<task type="auto">
  <name>Task 2: Create invite generator component</name>
  <files>components/teams/invite-generator.tsx</files>
  <action>
Create invite generation UI component:

```typescript
'use client';

import { useState } from 'react';
import { useTranslations } from 'next-intl';
import { generateInviteLink } from '@/lib/db/invites';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Slider } from '@/components/ui/slider';
import { Link2, Copy, Check, Share2, MessageCircle } from 'lucide-react';

interface InviteGeneratorProps {
  teamId: string;
  userId: string;
}

export function InviteGenerator({ teamId, userId }: InviteGeneratorProps) {
  const t = useTranslations('invites');
  const [isGenerating, setIsGenerating] = useState(false);
  const [inviteLink, setInviteLink] = useState<string | null>(null);
  const [maxUses, setMaxUses] = useState(50);
  const [copied, setCopied] = useState(false);

  const handleGenerate = async () => {
    setIsGenerating(true);
    try {
      const { link } = await generateInviteLink(teamId, userId, { maxUses });
      setInviteLink(link);
    } catch (error) {
      console.error('Failed to generate invite:', error);
    } finally {
      setIsGenerating(false);
    }
  };

  const handleCopy = async () => {
    if (!inviteLink) return;
    await navigator.clipboard.writeText(inviteLink);
    setCopied(true);
    setTimeout(() => setCopied(false), 2000);
  };

  const handleShareWhatsApp = () => {
    if (!inviteLink) return;
    const text = encodeURIComponent(`${t('whatsapp.message')} ${inviteLink}`);
    window.open(`https://wa.me/?text=${text}`, '_blank');
  };

  const handleShareEmail = () => {
    if (!inviteLink) return;
    const subject = encodeURIComponent(t('email.subject'));
    const body = encodeURIComponent(`${t('email.body')}\n\n${inviteLink}`);
    window.open(`mailto:?subject=${subject}&body=${body}`, '_blank');
  };

  return (
    <Card>
      <CardHeader>
        <CardTitle className="flex items-center gap-2">
          <Link2 className="h-5 w-5" />
          {t('generator.title')}
        </CardTitle>
      </CardHeader>
      <CardContent className="space-y-6">
        {!inviteLink ? (
          <>
            <div className="space-y-3">
              <Label>{t('generator.maxUses')}</Label>
              <div className="flex items-center gap-4">
                <Slider
                  value={[maxUses]}
                  min={1}
                  max={100}
                  step={1}
                  onValueChange={([v]) => setMaxUses(v)}
                  className="flex-1"
                />
                <span className="w-12 text-right font-medium">{maxUses}</span>
              </div>
              <p className="text-xs text-muted-foreground">
                {t('generator.maxUsesHint')}
              </p>
            </div>

            <Button
              onClick={handleGenerate}
              disabled={isGenerating}
              className="w-full h-12"
            >
              {isGenerating ? t('generator.generating') : t('generator.button')}
            </Button>
          </>
        ) : (
          <div className="space-y-4">
            <div className="space-y-2">
              <Label>{t('generator.linkLabel')}</Label>
              <div className="flex gap-2">
                <Input
                  value={inviteLink}
                  readOnly
                  className="flex-1 h-12"
                />
                <Button
                  variant="outline"
                  size="icon"
                  className="h-12 w-12 shrink-0"
                  onClick={handleCopy}
                >
                  {copied ? (
                    <Check className="h-4 w-4 text-green-500" />
                  ) : (
                    <Copy className="h-4 w-4" />
                  )}
                </Button>
              </div>
            </div>

            <div className="grid grid-cols-2 gap-3">
              <Button
                variant="outline"
                className="h-12"
                onClick={handleShareWhatsApp}
              >
                <MessageCircle className="mr-2 h-4 w-4" />
                WhatsApp
              </Button>
              <Button
                variant="outline"
                className="h-12"
                onClick={handleShareEmail}
              >
                <Share2 className="mr-2 h-4 w-4" />
                {t('generator.email')}
              </Button>
            </div>

            <Button
              variant="ghost"
              className="w-full"
              onClick={() => setInviteLink(null)}
            >
              {t('generator.createNew')}
            </Button>
          </div>
        )}
      </CardContent>
    </Card>
  );
}
```

NOTE: Generate button creates link with configurable max uses. Copy to clipboard with visual feedback. WhatsApp and Email share buttons. Create new button resets to generate another.
  </action>
  <verify>Component compiles; Slider component available in shadcn/ui</verify>
  <done>Invite generator with max uses slider, copy button, and WhatsApp/email share</done>
</task>

<task type="auto">
  <name>Task 3: Create invite redemption page</name>
  <files>app/[locale]/teams/invite/page.tsx</files>
  <action>
Create the invite redemption page:

```typescript
'use client';

import { useEffect, useState } from 'react';
import { useSearchParams, useRouter } from 'next/navigation';
import { useTranslations } from 'next-intl';
import { getInviteByToken, joinTeamWithInvite } from '@/lib/db/invites';
import { createClient } from '@/lib/supabase/client';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';
import { Loader2, CheckCircle, XCircle, Users, AlertCircle } from 'lucide-react';
import Link from 'next/link';

type InviteState = 'loading' | 'valid' | 'invalid' | 'expired' | 'maxed';

export default function InvitePage() {
  const t = useTranslations('invites');
  const searchParams = useSearchParams();
  const router = useRouter();
  const token = searchParams.get('token');

  const [inviteState, setInviteState] = useState<InviteState>('loading');
  const [teamName, setTeamName] = useState<string>('');
  const [isJoining, setIsJoining] = useState(false);
  const [joinResult, setJoinResult] = useState<'success' | 'already_member' | 'error' | null>(null);
  const [isAuthenticated, setIsAuthenticated] = useState<boolean | null>(null);

  useEffect(() => {
    checkAuthAndInvite();
  }, [token]);

  async function checkAuthAndInvite() {
    const supabase = createClient();
    const { data: { user } } = await supabase.auth.getUser();
    setIsAuthenticated(!!user);

    if (!token) {
      setInviteState('invalid');
      return;
    }

    const invite = await getInviteByToken(token);
    if (!invite) {
      setInviteState('invalid');
      return;
    }

    // Get team name
    const { data: team } = await supabase
      .from('teams')
      .select('name')
      .eq('id', invite.team_id)
      .single();

    setTeamName(team?.name || t('unknownTeam'));
    setInviteState('valid');
  }

  const handleJoin = async () => {
    if (!token) return;

    const supabase = createClient();
    const { data: { user } } = await supabase.auth.getUser();
    if (!user) {
      // Should not happen due to auth check, but handle gracefully
      setJoinResult('error');
      return;
    }

    setIsJoining(true);
    const result = await joinTeamWithInvite(token, user.id);
    setIsJoining(false);

    if (result.success) {
      setJoinResult('success');
      // Redirect to team page after delay
      setTimeout(() => {
        router.push(`/teams/${result.teamId}`);
      }, 2000);
    } else if (result.error === 'already_member') {
      setJoinResult('already_member');
    } else {
      setJoinResult('error');
    }
  };

  if (inviteState === 'loading') {
    return (
      <div className="container mx-auto px-4 py-12">
        <div className="flex items-center justify-center">
          <Loader2 className="h-8 w-8 animate-spin text-muted-foreground" />
        </div>
      </div>
    );
  }

  if (inviteState === 'invalid') {
    return (
      <div className="container mx-auto px-4 py-12 max-w-md">
        <Card>
          <CardContent className="pt-6 text-center">
            <XCircle className="mx-auto h-12 w-12 text-destructive mb-4" />
            <CardTitle className="mb-2">{t('invalid.title')}</CardTitle>
            <CardDescription>{t('invalid.description')}</CardDescription>
            <Link href="/teams" className="mt-6 block">
              <Button className="w-full h-12">{t('invalid.backToTeams')}</Button>
            </Link>
          </CardContent>
        </Card>
      </div>
    );
  }

  if (!isAuthenticated) {
    return (
      <div className="container mx-auto px-4 py-12 max-w-md">
        <Card>
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <Users className="h-5 w-5" />
              {t('join.title', { teamName })}
            </CardTitle>
            <CardDescription>{t('join.description')}</CardDescription>
          </CardHeader>
          <CardContent className="space-y-4">
            <p className="text-sm text-muted-foreground">{t('join.loginRequired')}</p>
            <Link href={`/auth/login?redirect=/teams/invite?token=${token}`}>
              <Button className="w-full h-12">{t('join.loginButton')}</Button>
            </Link>
          </CardContent>
        </Card>
      </div>
    );
  }

  if (joinResult === 'success') {
    return (
      <div className="container mx-auto px-4 py-12 max-w-md">
        <Card>
          <CardContent className="pt-6 text-center">
            <CheckCircle className="mx-auto h-12 w-12 text-green-500 mb-4" />
            <CardTitle className="mb-2">{t('success.title')}</CardTitle>
            <CardDescription>{t('success.description', { teamName })}</CardDescription>
          </CardContent>
        </Card>
      </div>
    );
  }

  if (joinResult === 'already_member') {
    return (
      <div className="container mx-auto px-4 py-12 max-w-md">
        <Card>
          <CardContent className="pt-6 text-center">
            <AlertCircle className="mx-auto h-12 w-12 text-yellow-500 mb-4" />
            <CardTitle className="mb-2">{t('alreadyMember.title')}</CardTitle>
            <CardDescription>{t('alreadyMember.description', { teamName })}</CardDescription>
            <Link href={`/teams`} className="mt-6 block">
              <Button className="w-full h-12">{t('alreadyMember.viewTeam')}</Button>
            </Link>
          </CardContent>
        </Card>
      </div>
    );
  }

  return (
    <div className="container mx-auto px-4 py-12 max-w-md">
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Users className="h-5 w-5" />
            {t('join.title', { teamName })}
          </CardTitle>
          <CardDescription>{t('join.description')}</CardDescription>
        </CardHeader>
        <CardContent className="space-y-4">
          {joinResult === 'error' && (
            <p className="text-sm text-destructive">{t('join.error')}</p>
          )}
          <Button
            onClick={handleJoin}
            disabled={isJoining}
            className="w-full h-12"
          >
            {isJoining ? (
              <>
                <Loader2 className="mr-2 h-4 w-4 animate-spin" />
                {t('join.joining')}
              </>
            ) : (
              t('join.button')
            )}
          </Button>
          <Link href="/teams">
            <Button variant="ghost" className="w-full">
              {t('join.cancel')}
            </Button>
          </Link>
        </CardContent>
      </Card>
    </div>
  );
}
```

NOTE: Handles all states: loading, invalid token, not authenticated, ready to join, success, already member, error. Redirects unauthenticated users to login with return URL. Shows team name from invite validation.
  </action>
  <verify>Page compiles; dynamic route handles query params correctly</verify>
  <done>Invite redemption page with all states and join flow</done>
</task>

<task type="auto">
  <name>Task 4: Create team settings page with invite management</name>
  <files>app/[locale]/teams/[teamId]/settings/page.tsx</files>
  <action>
Create team settings page with invite generator:

```typescript
'use client';

import { useEffect, useState } from 'react';
import { useParams } from 'next/navigation';
import { useTranslations } from 'next-intl';
import { InviteGenerator } from '@/components/teams/invite-generator';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { ArrowLeft, Settings, Trash2 } from 'lucide-react';
import Link from 'next/link';
import { createClient } from '@/lib/supabase/client';

export default function TeamSettingsPage() {
  const t = useTranslations('settings');
  const params = useParams();
  const teamId = params.teamId as string;

  const [userId, setUserId] = useState<string | null>(null);
  const [isAdmin, setIsAdmin] = useState(false);
  const [isLoading, setIsLoading] = useState(true);

  useEffect(() => {
    checkAdminStatus();
  }, [teamId]);

  async function checkAdminStatus() {
    const supabase = createClient();
    const { data: { user } } = await supabase.auth.getUser();

    if (!user) {
      setIsLoading(false);
      return;
    }

    setUserId(user.id);

    // Check if user is admin
    const { data: membership } = await supabase
      .from('team_members')
      .select('role')
      .eq('team_id', teamId)
      .eq('user_id', user.id)
      .single();

    setIsAdmin(membership?.role === 'admin' || membership?.role === 'co-admin');
    setIsLoading(false);
  }

  if (isLoading) {
    return (
      <div className="container mx-auto px-4 py-8">
        <div className="animate-pulse space-y-4">
          <div className="h-8 bg-muted rounded w-1/3" />
          <div className="h-32 bg-muted rounded" />
        </div>
      </div>
    );
  }

  if (!isAdmin) {
    return (
      <div className="container mx-auto px-4 py-8">
        <p className="text-center text-muted-foreground">{t('notAdmin')}</p>
      </div>
    );
  }

  return (
    <div className="container mx-auto px-4 py-8">
      <div className="mb-6">
        <Link href={`/teams/${teamId}`}>
          <Button variant="ghost" className="pl-0">
            <ArrowLeft className="mr-2 h-4 w-4" />
            {t('backToTeam')}
          </Button>
        </Link>
      </div>

      <div className="max-w-2xl space-y-6">
        <h1 className="text-2xl font-bold flex items-center gap-2">
          <Settings className="h-6 w-6" />
          {t('title')}
        </h1>

        {/* Invite Section */}
        {userId && <InviteGenerator teamId={teamId} userId={userId} />}

        {/* Danger Zone */}
        <Card className="border-destructive">
          <CardHeader>
            <CardTitle className="text-destructive flex items-center gap-2">
              <Trash2 className="h-5 w-5" />
              {t('dangerZone.title')}
            </CardTitle>
          </CardHeader>
          <CardContent>
            <p className="text-sm text-muted-foreground mb-4">
              {t('dangerZone.description')}
            </p>
            <Button variant="destructive" className="h-12">
              {t('dangerZone.deleteTeam')}
            </Button>
          </CardContent>
        </Card>
      </div>
    </div>
  );
}
```

NOTE: Admin-only page. Shows invite generator and danger zone for team deletion (actual delete implemented in Plan 05). Checks admin status from team_members.
  </action>
  <verify>Page compiles; admin check implemented</verify>
  <done>Team settings page with invite generator and admin-only access</done>
</task>

<task type="auto">
  <name>Task 5: Add invite translations</name>
  <files>
    messages/it.json
    messages/en.json
  </files>
  <action>
Add invite-related translations:

**messages/it.json:**
```json
{
  "invites": {
    "generator": {
      "title": "Invita giocatori",
      "maxUses": "Numero massimo di utilizzi",
      "maxUsesHint": "Quante persone possono usare questo link",
      "button": "Genera link di invito",
      "generating": "Generazione...",
      "linkLabel": "Link di invito",
      "email": "Email",
      "createNew": "Crea nuovo link"
    },
    "whatsapp": {
      "message": "Unisciti alla mia squadra su Calcetto Manager!"
    },
    "email": {
      "subject": "Invito a unirsi alla squadra",
      "body": "Ciao! Ti invito a unirti alla nostra squadra su Calcetto Manager."
    },
    "join": {
      "title": "Unisciti a {teamName}",
      "description": "Hai ricevuto un invito a unirti a questa squadra",
      "loginRequired": "Accedi per unirti alla squadra",
      "loginButton": "Accedi",
      "button": "Unisciti alla squadra",
      "joining": "Unione in corso...",
      "cancel": "Annulla",
      "error": "Impossibile unirsi alla squadra. Riprova."
    },
    "success": {
      "title": "Benvenuto!",
      "description": "Ti sei unito con successo a {teamName}"
    },
    "alreadyMember": {
      "title": "Sei già membro",
      "description": "Fai già parte di {teamName}",
      "viewTeam": "Vai alla squadra"
    },
    "invalid": {
      "title": "Link non valido",
      "description": "Questo link di invito è scaduto o non esiste",
      "backToTeams": "Torna alle squadre"
    },
    "unknownTeam": "Squadra sconosciuta"
  },
  "settings": {
    "title": "Impostazioni squadra",
    "backToTeam": "Torna alla squadra",
    "notAdmin": "Solo gli admin possono gestire le impostazioni",
    "dangerZone": {
      "title": "Zona pericolosa",
      "description": "Le azioni qui sotto sono irreversibili",
      "deleteTeam": "Elimina squadra"
    }
  }
}
```

Add corresponding English translations to messages/en.json.
  </action>
  <verify>JSON valid; no duplicate keys</verify>
  <done>Invite and settings translations added</done>
</task>

</tasks>

<verification>
After completion:
1. Admin can generate invite link from team settings
2. Link can be copied or shared via WhatsApp/email
3. Visiting /teams/invite?token=xxx shows join page
4. Unauthenticated users see login prompt
5. Authenticated users can join team
6. Success redirects to team page
7. Already-member users see appropriate message
</verification>

<success_criteria>
- Invite generation with configurable max uses (TEAM-05)
- Share via WhatsApp and email works
- Invite redemption flow for joining (TEAM-06)
- Token validation and expiration checks
- Duplicate join prevention
- All states handled with proper UX
</success_criteria>

<output>
After completion, create `.planning/phases/02-team-management/02-04-SUMMARY.md`
</output>
